# üéØ –ü–†–û–ú–ü–¢ –î–õ–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–ò –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–†–ê –ë–ê–¶–ó–´ –í –ü–†–ò–õ–û–ñ–ï–ù–ò–ï

## üìã –ß–¢–û –≠–¢–û –¢–ê–ö–û–ï

–ì–æ—Ç–æ–≤—ã–π **—ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ë–∞–¶–∑—ã (ÂÖ´Â≠ó)** —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 97-98%, –∫–æ—Ç–æ—Ä—ã–π:
- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É –ë–∞–¶–∑—ã (4 —Å—Ç–æ–ª–ø–∞: –≥–æ–¥, –º–µ—Å—è—Ü, –¥–µ–Ω—å, —á–∞—Å)
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏–ª—É —ç–ª–µ–º–µ–Ω—Ç–∞ –ª–∏—á–Ω–æ—Å—Ç–∏ –∏ –±–∞–ª–∞–Ω—Å –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç–æ–ª–ø—ã —É–¥–∞—á–∏ (Â§ßËøê) —Å —Ç–æ—á–Ω—ã–º –≤–æ–∑—Ä–∞—Å—Ç–æ–º –Ω–∞—á–∞–ª–∞
- –í—ã—è–≤–ª—è–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Å—Ç–æ–ª–ø–∞–º–∏ (—Å–ª–∏—è–Ω–∏—è, —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è, –Ω–∞–∫–∞–∑–∞–Ω–∏—è, –≤—Ä–µ–¥–∏)
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–∏–ª—É –Ω–µ–±–µ—Å–Ω—ã—Ö —Å—Ç–≤–æ–ª–æ–≤ –ø–æ —Å–µ–∑–æ–Ω—É
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–ø—Ä–æ–≥–Ω–æ–∑—ã, —Å–æ–≤–µ—Ç—ã, —Ä–∏—Ç—É–∞–ª—ã) –≤ –¥–≤—É—Ö —Å—Ç–∏–ª—è—Ö

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

---

## üìÅ –ì–î–ï –ù–ê–•–û–î–Ø–¢–°–Ø –§–ê–ô–õ–´

```
cosmos-of-hopes-cn/–ë–∞–¶–ó–´/
‚îú‚îÄ‚îÄ bazi-calculator-expert.js    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (ES –º–æ–¥—É–ª—å)
‚îú‚îÄ‚îÄ content-generator.js          # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (ES –º–æ–¥—É–ª—å)
‚îú‚îÄ‚îÄ package.json                  # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ test-expert.js                # –¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)
‚îî‚îÄ‚îÄ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è .md —Ñ–∞–π–ª—ã]     # –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

**–í–∞–∂–Ω–æ:** –§–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç ES –º–æ–¥—É–ª–∏ (`import/export`), –Ω–µ CommonJS.

---

## üì¶ –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–≥–¥–µ `package.json` –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è):

```bash
npm install lunisolar moment-timezone
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `lunisolar` (v2.6.0+) ‚Äî –∫–∏—Ç–∞–π—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å, —Å–æ–ª–Ω–µ—á–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã, —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–ª–ø–æ–≤
- `moment-timezone` (v0.6.0+) ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏

---

## üöÄ –í–ê–†–ò–ê–ù–¢–´ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### –í–∞—Ä–∏–∞–Ω—Ç 1: API Route (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Next.js)

–°–æ–∑–¥–∞—Ç—å API endpoint –≤ Next.js App Router:

**–§–∞–π–ª:** `app/api/bazi/route.ts` (–∏–ª–∏ `pages/api/bazi.ts` –¥–ª—è Pages Router)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { getFullBaziAnalysis } from '../../../../cosmos-of-hopes-cn/–ë–∞–¶–ó–´/bazi-calculator-expert.js';
import { generateContent, formatContentForDisplay } from '../../../../cosmos-of-hopes-cn/–ë–∞–¶–ó–´/content-generator.js';

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { dateTime, gender, timezone, year = 2026, yearAnimal = '–û–≥–Ω–µ–Ω–Ω–∞—è –õ–æ—à–∞–¥—å', style = 'poetic' } = body;

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!dateTime || !gender || !timezone) {
      return NextResponse.json(
        { error: 'Missing required fields: dateTime, gender, timezone' },
        { status: 400 }
      );
    }

    // –ü–æ–ª—É—á–∞–µ–º –∞–Ω–∞–ª–∏–∑ –ë–∞–¶–∑—ã
    const baziAnalysis = getFullBaziAnalysis(dateTime, gender, timezone);

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
    const content = generateContent(baziAnalysis, year, yearAnimal, style);
    const formatted = formatContentForDisplay(content);

    return NextResponse.json({
      success: true,
      analysis: baziAnalysis,
      content: formatted,
      rawContent: content
    });

  } catch (error) {
    console.error('Bazi calculation error:', error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'Unknown error' },
      { status: 500 }
    );
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:**

```typescript
const response = await fetch('/api/bazi', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    dateTime: '1983-11-19 08:15',
    gender: 'female',
    timezone: 'Europe/Moscow',
    year: 2026,
    yearAnimal: '–û–≥–Ω–µ–Ω–Ω–∞—è –õ–æ—à–∞–¥—å',
    style: 'poetic' // –∏–ª–∏ 'practical'
  })
});

const data = await response.json();
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (Server Components)

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Next.js App Router —Å Server Components:

**–§–∞–π–ª:** `app/bazi/page.tsx`

```typescript
import { getFullBaziAnalysis } from '../../../cosmos-of-hopes-cn/–ë–∞–¶–ó–´/bazi-calculator-expert.js';
import { generateContent, formatContentForDisplay } from '../../../cosmos-of-hopes-cn/–ë–∞–¶–ó–´/content-generator.js';

export default async function BaziPage({ searchParams }: { searchParams: { dateTime?: string, gender?: string, timezone?: string } }) {
  if (!searchParams.dateTime || !searchParams.gender || !searchParams.timezone) {
    return <div>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è, –ø–æ–ª –∏ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å</div>;
  }

  const analysis = getFullBaziAnalysis(
    searchParams.dateTime,
    searchParams.gender,
    searchParams.timezone
  );

  const content = generateContent(analysis, 2026, '–û–≥–Ω–µ–Ω–Ω–∞—è –õ–æ—à–∞–¥—å', 'poetic');
  const formatted = formatContentForDisplay(content);

  return (
    <div>
      <h1>–í–∞—à–∞ –∫–∞—Ä—Ç–∞ –ë–∞–¶–∑—ã</h1>
      <p>–°—Ç–æ–ª–ø—ã: {analysis.pillars.join(' ')}</p>
      <p>–≠–ª–µ–º–µ–Ω—Ç: {analysis.dayMaster.element} ({analysis.dayMaster.strengthText})</p>
      <h2>–ü—Ä–æ–≥–Ω–æ–∑</h2>
      <p>{formatted.mainForecast}</p>
      {/* ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */}
    </div>
  );
}
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£—Ç–∏–ª–∏—Ç–∞/–°–µ—Ä–≤–∏—Å (–¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

**–§–∞–π–ª:** `lib/bazi-service.ts`

```typescript
import { getFullBaziAnalysis } from '../../cosmos-of-hopes-cn/–ë–∞–¶–ó–´/bazi-calculator-expert.js';
import { generateContent, formatContentForDisplay } from '../../cosmos-of-hopes-cn/–ë–∞–¶–ó–´/content-generator.js';

export interface BaziRequest {
  dateTime: string;      // –§–æ—Ä–º–∞—Ç: 'YYYY-MM-DD HH:mm'
  gender: 'male' | 'female';
  timezone: string;      // –ù–∞–ø—Ä–∏–º–µ—Ä: 'Europe/Moscow'
  year?: number;         // –ì–æ–¥ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–∫—É—â–∏–π)
  yearAnimal?: string;  // –ñ–∏–≤–æ—Ç–Ω–æ–µ –≥–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, '–û–≥–Ω–µ–Ω–Ω–∞—è –õ–æ—à–∞–¥—å')
  style?: 'poetic' | 'practical';
}

export interface BaziResponse {
  success: boolean;
  analysis: ReturnType<typeof getFullBaziAnalysis>;
  content: ReturnType<typeof formatContentForDisplay>;
}

export async function calculateBazi(params: BaziRequest): Promise<BaziResponse> {
  const analysis = getFullBaziAnalysis(params.dateTime, params.gender, params.timezone);
  const content = generateContent(
    analysis,
    params.year || new Date().getFullYear(),
    params.yearAnimal || '–û–≥–Ω–µ–Ω–Ω–∞—è –õ–æ—à–∞–¥—å',
    params.style || 'poetic'
  );
  const formatted = formatContentForDisplay(content);

  return {
    success: true,
    analysis,
    content: formatted
  };
}
```

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•

### –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ (`baziAnalysis`):

```typescript
{
  success: true,
  pillars: ['Áô∏‰∫•', 'Áô∏‰∫•', 'Ëæõ‰∫•', 'Áî≤Âçà'],  // 4 —Å—Ç–æ–ª–ø–∞
  dayMaster: {
    glyph: 'Ëæõ',
    element: '–ú–µ—Ç–∞–ª–ª',
    strength: 2,              // 1-5
    strengthText: '—Å–ª–∞–±—ã–π',   // '–æ—á–µ–Ω—å —Å–ª–∞–±—ã–π' | '—Å–ª–∞–±—ã–π' | '–±–∞–ª–∞–Ω—Å–Ω—ã–π' | '—Å–∏–ª—å–Ω—ã–π' | '–æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π'
    strengthDetails: {
      seasonScore: 1,
      rootScore: 2,
      supportScore: 1,
      controlScore: 3
    }
  },
  elementBalance: {
    '–î–µ—Ä–µ–≤–æ': 1.90,
    '–û–≥–æ–Ω—å': 1.70,
    '–ó–µ–º–ª—è': 0.30,
    '–ú–µ—Ç–∞–ª–ª': 1.00,
    '–í–æ–¥–∞': 7.10
  },
  luckPillars: [{
    startAge: 4.8,           // –¢–æ—á–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –Ω–∞—á–∞–ª–∞
    ageRange: '4-13 –ª–µ—Ç',
    pillar: 'Â£¨Êàå',
    element: '–í–æ–¥–∞'
  }],
  interactions: [{           // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å—Ç–æ–ª–ø–æ–≤
    type: 'Âàë',
    name: '‰∫•Ëá™Âàë',
    pillars: ['Âπ¥Êü±', 'ÊúàÊü±'],
    description: '–°–∞–º–æ–Ω–∞–∫–∞–∑–∞–Ω–∏–µ –°–≤–∏–Ω—å–∏...',
    impact: 'negative'       // 'positive' | 'negative' | 'neutral'
  }],
  stemInteractions: [{       // –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –Ω–µ–±–µ—Å–Ω—ã—Ö —Å—Ç–≤–æ–ª–æ–≤ (ÂêàÂåñ)
    type: 'ÂêàÂåñ',
    name: 'Áî≤Â∑±ÂêàÂåñÂúü',
    pillars: ['Âπ¥Êü±', 'ÊúàÊü±'],
    transformsTo: '–ó–µ–º–ª—è',
    description: '–°–ª–∏—è–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç –ó–µ–º–ª—é...'
  }],
  specialCombinations: [{    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (‰∏âÂêà, ‰∏â‰ºö)
    type: '‰∏âÂêà',
    name: 'Áî≥Â≠êËæ∞‰∏âÂêàÊ∞¥',
    pillars: ['Âπ¥Êü±', 'ÊúàÊü±', 'Êó•Êü±'],
    element: '–í–æ–¥–∞',
    completeness: 'complete',  // 'complete' | 'partial'
    description: '–¢—Ä–æ–π–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ...'
  }],
  stemStrengths: {
    year: {
      glyph: 'Áô∏',
      element: '–í–æ–¥–∞',
      state: 'Êó∫',            // Êó∫ | Áõ∏ | ‰ºë | Âõö | Ê≠ª
      strength: 5,
      strengthText: '–æ—á–µ–Ω—å —Å–∏–ª—å–Ω—ã–π'
    },
    month: { ... },
    day: { ... },
    hour: { ... }
  }
}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (`formatted`):

```typescript
{
  style: 'poetic',           // –∏–ª–∏ 'practical'
  mainForecast: '2026 –≥–æ–¥ (–û–≥–Ω–µ–Ω–Ω–∞—è –õ–æ—à–∞–¥—å): –ì–æ–¥ –ó–∞—Ç–æ—á–∫–∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞...',
  energy: '–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∏–µ–º –Ω–∞ –≥–ª–∞–≤–Ω–æ–º...',
  advice: '–°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –æ—Ç—Ç–∞—á–∏–≤–∞–Ω–∏–∏...',
  ritual: '–ó–∞–≤–µ–¥–∏—Ç–µ ¬´–ñ—É—Ä–Ω–∞–ª —è—Å–Ω–æ—Å—Ç–∏¬ª...',
  recommendations: {
    amulet: '–ê–º—É–ª–µ—Ç: –ë—Ä–µ–ª–æ–∫ –≤ —Ñ–æ—Ä–º–µ –º–æ–Ω–µ—Ç—ã...',
    action: '–î–µ–π—Å—Ç–≤–∏–µ: –ü—Ä–æ–≤–µ–¥–∏—Ç–µ —Ä–µ–≤–∏–∑–∏—é...',
    colors: '–ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞: –∂—ë–ª—Ç—ã–π/–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π, –±–µ–ª—ã–π/–∑–æ–ª–æ—Ç–æ–π'
  },
  warnings: {
    months: '–ò–∑–±–µ–≥–∞–π—Ç–µ —É—á–∞—Å—Ç–∏—è –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö...',
    health: '–ë–µ—Ä–µ–≥–∏—Ç–µ –ª—ë–≥–∫–∏–µ –∏ –∫–æ–∂—É...',
    additional: '...'
  },
  interactions: {
    positive: [{ type: 'Âêà', description: '...' }],
    neutral: [],
    warnings: [{ type: 'Âàë', description: '...' }]
  },
  stemAdvice: [
    { pillar: '–ì–æ–¥', advice: '...' }
  ],
  interactionNotes: ['...']
}
```

---

## üé® –ü–†–ò–ú–ï–†–´ UI –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã –ë–∞–¶–∑—ã:

**–§–∞–π–ª:** `components/bazi/BaziCard.tsx`

```typescript
'use client';

interface BaziCardProps {
  analysis: {
    pillars: string[];
    dayMaster: {
      element: string;
      strengthText: string;
    };
    elementBalance: Record<string, number>;
  };
}

export function BaziCard({ analysis }: BaziCardProps) {
  return (
    <div className="p-6 bg-white rounded-lg shadow-lg">
      <h2 className="text-2xl font-bold mb-4">–í–∞—à–∞ –∫–∞—Ä—Ç–∞ –ë–∞–¶–∑—ã</h2>
      
      {/* –°—Ç–æ–ª–ø—ã */}
      <div className="mb-6">
        <h3 className="text-lg font-semibold mb-2">–ù–∞—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–æ–ª–ø—ã</h3>
        <div className="flex gap-4 text-3xl">
          {analysis.pillars.map((pillar, i) => (
            <div key={i} className="text-center">
              <div className="font-bold">{pillar}</div>
              <div className="text-sm text-gray-500">
                {['–ì–æ–¥', '–ú–µ—Å—è—Ü', '–î–µ–Ω—å', '–ß–∞—Å'][i]}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* –≠–ª–µ–º–µ–Ω—Ç –ª–∏—á–Ω–æ—Å—Ç–∏ */}
      <div className="mb-6">
        <h3 className="text-lg font-semibold mb-2">–≠–ª–µ–º–µ–Ω—Ç –ª–∏—á–Ω–æ—Å—Ç–∏</h3>
        <p className="text-xl">
          <span className="font-bold">{analysis.dayMaster.element}</span>
          {' '}
          <span className="text-gray-600">({analysis.dayMaster.strengthText})</span>
        </p>
      </div>

      {/* –ë–∞–ª–∞–Ω—Å —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */}
      <div className="mb-6">
        <h3 className="text-lg font-semibold mb-2">–ë–∞–ª–∞–Ω—Å —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h3>
        <div className="space-y-2">
          {Object.entries(analysis.elementBalance).map(([element, value]) => (
            <div key={element} className="flex items-center gap-2">
              <span className="w-24">{element}:</span>
              <div className="flex-1 bg-gray-200 rounded-full h-4">
                <div
                  className="bg-blue-500 h-4 rounded-full"
                  style={{ width: `${(value / 10) * 100}%` }}
                />
              </div>
              <span className="text-sm text-gray-600">{value.toFixed(2)}</span>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞:

**–§–∞–π–ª:** `components/bazi/BaziForecast.tsx`

```typescript
'use client';

interface BaziForecastProps {
  content: {
    mainForecast: string;
    energy: string;
    advice: string;
    ritual: string;
    recommendations: {
      amulet: string;
      action: string;
      colors: string;
    };
    warnings: {
      months: string;
      health: string;
    };
  };
  style: 'poetic' | 'practical';
  onStyleChange?: (style: 'poetic' | 'practical') => void;
}

export function BaziForecast({ content, style, onStyleChange }: BaziForecastProps) {
  return (
    <div className="p-6 bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg shadow-lg">
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-2xl font-bold">–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –≥–æ–¥</h2>
        {onStyleChange && (
          <div className="flex gap-2">
            <button
              onClick={() => onStyleChange('poetic')}
              className={`px-4 py-2 rounded ${style === 'poetic' ? 'bg-purple-500 text-white' : 'bg-gray-200'}`}
            >
              –ü–æ—ç—Ç–∏—á–µ—Å–∫–∏–π
            </button>
            <button
              onClick={() => onStyleChange('practical')}
              className={`px-4 py-2 rounded ${style === 'practical' ? 'bg-purple-500 text-white' : 'bg-gray-200'}`}
            >
              –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π
            </button>
          </div>
        )}
      </div>

      <div className="space-y-6">
        <section>
          <h3 className="text-lg font-semibold mb-2">üìä –ü—Ä–æ–≥–Ω–æ–∑</h3>
          <p className="text-gray-700">{content.mainForecast}</p>
        </section>

        <section>
          <h3 className="text-lg font-semibold mb-2">üí´ –≠–Ω–µ—Ä–≥–∏—è –≥–æ–¥–∞</h3>
          <p className="text-gray-700">{content.energy}</p>
        </section>

        <section>
          <h3 className="text-lg font-semibold mb-2">üí° –°–æ–≤–µ—Ç</h3>
          <p className="text-gray-700">{content.advice}</p>
        </section>

        <section>
          <h3 className="text-lg font-semibold mb-2">‚ú® –†–∏—Ç—É–∞–ª</h3>
          <p className="text-gray-700">{content.ritual}</p>
        </section>

        <section className="bg-white p-4 rounded">
          <h3 className="text-lg font-semibold mb-2">üíé –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
          <ul className="space-y-2 text-gray-700">
            <li>{content.recommendations.amulet}</li>
            <li>{content.recommendations.action}</li>
            <li>{content.recommendations.colors}</li>
          </ul>
        </section>

        <section className="bg-yellow-50 p-4 rounded border-l-4 border-yellow-400">
          <h3 className="text-lg font-semibold mb-2">‚ö†Ô∏è –ü—Ä–µ–¥–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–∏—è</h3>
          <ul className="space-y-2 text-gray-700">
            <li><strong>–ú–µ—Å—è—Ü—ã:</strong> {content.warnings.months}</li>
            <li><strong>–ó–¥–æ—Ä–æ–≤—å–µ:</strong> {content.warnings.health}</li>
          </ul>
        </section>
      </div>
    </div>
  );
}
```

### –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö:

**–§–∞–π–ª:** `components/bazi/BaziForm.tsx`

```typescript
'use client';

import { useState } from 'react';

interface BaziFormProps {
  onSubmit: (data: {
    dateTime: string;
    gender: 'male' | 'female';
    timezone: string;
    year?: number;
    yearAnimal?: string;
    style?: 'poetic' | 'practical';
  }) => void;
}

export function BaziForm({ onSubmit }: BaziFormProps) {
  const [dateTime, setDateTime] = useState('');
  const [gender, setGender] = useState<'male' | 'female'>('female');
  const [timezone, setTimezone] = useState('Europe/Moscow');
  const [style, setStyle] = useState<'poetic' | 'practical'>('poetic');

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    onSubmit({ dateTime, gender, timezone, style });
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-4 p-6 bg-white rounded-lg shadow-lg">
      <div>
        <label className="block text-sm font-medium mb-1">
          –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ä–æ–∂–¥–µ–Ω–∏—è
        </label>
        <input
          type="datetime-local"
          value={dateTime}
          onChange={(e) => setDateTime(e.target.value)}
          required
          className="w-full px-4 py-2 border rounded-lg"
        />
      </div>

      <div>
        <label className="block text-sm font-medium mb-1">–ü–æ–ª</label>
        <select
          value={gender}
          onChange={(e) => setGender(e.target.value as 'male' | 'female')}
          className="w-full px-4 py-2 border rounded-lg"
        >
          <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
          <option value="male">–ú—É–∂—Å–∫–æ–π</option>
        </select>
      </div>

      <div>
        <label className="block text-sm font-medium mb-1">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</label>
        <select
          value={timezone}
          onChange={(e) => setTimezone(e.target.value)}
          className="w-full px-4 py-2 border rounded-lg"
        >
          <option value="Europe/Moscow">–ú–æ—Å–∫–≤–∞ (UTC+3)</option>
          <option value="Europe/Kiev">–ö–∏–µ–≤ (UTC+2)</option>
          <option value="Asia/Shanghai">–ü–µ–∫–∏–Ω (UTC+8)</option>
          {/* –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞ */}
        </select>
      </div>

      <div>
        <label className="block text-sm font-medium mb-1">–°—Ç–∏–ª—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
        <select
          value={style}
          onChange={(e) => setStyle(e.target.value as 'poetic' | 'practical')}
          className="w-full px-4 py-2 border rounded-lg"
        >
          <option value="poetic">–ü–æ—ç—Ç–∏—á–µ—Å–∫–∏-–º–µ—Ç–∞—Ñ–æ—Ä–∏—á–µ—Å–∫–∏–π</option>
          <option value="practical">–†–∞–∑–≥–æ–≤–æ—Ä–Ω–æ-–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π</option>
        </select>
      </div>

      <button
        type="submit"
        className="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600 transition"
      >
        –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ë–∞–¶–∑—ã
      </button>
    </form>
  );
}
```

---

## üîß –ù–ê–°–¢–†–û–ô–ö–ê TYPESCRIPT

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ TypeScript, –¥–æ–±–∞–≤—å—Ç–µ —Ç–∏–ø—ã:

**–§–∞–π–ª:** `types/bazi.ts`

```typescript
export interface BaziAnalysis {
  success: boolean;
  pillars: [string, string, string, string];
  dayMaster: {
    glyph: string;
    element: string;
    strength: number;
    strengthText: string;
    strengthDetails: {
      seasonScore: number;
      rootScore: number;
      supportScore: number;
      controlScore: number;
    };
  };
  elementBalance: {
    –î–µ—Ä–µ–≤–æ: number;
    –û–≥–æ–Ω—å: number;
    –ó–µ–º–ª—è: number;
    –ú–µ—Ç–∞–ª–ª: number;
    –í–æ–¥–∞: number;
  };
  luckPillars: Array<{
    startAge: number;
    ageRange: string;
    pillar: string;
    element: string;
  }>;
  interactions: Array<{
    type: string;
    name: string;
    pillars: string[];
    description: string;
    impact: 'positive' | 'negative' | 'neutral';
  }>;
  stemInteractions: Array<{
    type: string;
    name: string;
    pillars: string[];
    transformsTo: string;
    description: string;
  }>;
  specialCombinations: Array<{
    type: string;
    name: string;
    pillars: string[];
    element: string;
    completeness: 'complete' | 'partial';
    season?: string;
    description: string;
  }>;
  stemStrengths: {
    year: StemStrength;
    month: StemStrength;
    day: StemStrength;
    hour: StemStrength;
  };
}

export interface StemStrength {
  glyph: string;
  element: string;
  state: 'Êó∫' | 'Áõ∏' | '‰ºë' | 'Âõö' | 'Ê≠ª';
  strength: number;
  strengthText: string;
}

export interface BaziContent {
  style: 'poetic' | 'practical';
  mainForecast: string;
  energy: string;
  advice: string;
  ritual: string;
  recommendations: {
    amulet: string;
    action: string;
    colors: string;
  };
  warnings: {
    months: string;
    health: string;
    additional?: string;
  };
  interactions: {
    positive: Array<{ type: string; description: string }>;
    neutral: Array<{ type: string; description: string }>;
    warnings: Array<{ type: string; description: string }>;
  };
  stemAdvice: Array<{ pillar: string; advice: string }>;
  interactionNotes: string[];
}
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

1. **ES –º–æ–¥—É–ª–∏:** –§–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `import/export`, –Ω–µ `require()`. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `package.json` –µ—Å—Ç—å `"type": "module"` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.mjs` —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.

2. **–ü—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º:** –ï—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `cosmos-of-hopes-cn/–ë–∞–¶–ó–´/`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –æ—Ç –º–µ—Å—Ç–∞ –≤—ã–∑–æ–≤–∞.

3. **–ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'Europe/Moscow'`), –∏–Ω–∞—á–µ —Ä–∞—Å—á—ë—Ç —á–∞—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–º.

4. **–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç `'YYYY-MM-DD HH:mm'` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `'1983-11-19 08:15'`).

5. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Å—Ç—Ä—ã–π, –Ω–æ –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API route —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–ü–µ—Ä–µ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞:

```bash
cd cosmos-of-hopes-cn/–ë–∞–¶–ó–´
node test-expert.js
```

–î–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –≤ –æ–±–æ–∏—Ö —Å—Ç–∏–ª—è—Ö.

---

## üìö –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

–í –ø–∞–ø–∫–µ `cosmos-of-hopes-cn/–ë–∞–¶–ó–´/` –µ—Å—Ç—å –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `FINAL_SUMMARY.md` ‚Äî –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —É–ª—É—á—à–µ–Ω–∏–π
- `EXPERT_IMPROVEMENTS.md` ‚Äî –¥–µ—Ç–∞–ª–∏ —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- `CONTENT_PHILOSOPHY.md` ‚Äî —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- `CONTENT_STYLES.md` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –¥–≤—É—Ö —Å—Ç–∏–ª–µ–π
- `EXPANDED_INTERACTIONS.md` ‚Äî –≤—Å–µ —Ç–∏–ø—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`lunisolar`, `moment-timezone`)
- [ ] –°–æ–∑–¥–∞–Ω API route –∏–ª–∏ —Å–µ—Ä–≤–∏—Å –¥–ª—è –≤—ã–∑–æ–≤–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã TypeScript —Ç–∏–ø—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –°–æ–∑–¥–∞–Ω—ã UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏ –∏ —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

