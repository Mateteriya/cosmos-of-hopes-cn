// content-generator.js - СИСТЕМА ГЕНЕРАЦИИ КОНТЕНТА С ДВУМЯ СТИЛЯМИ
// Генерирует персонализированные прогнозы на языке возможностей
// Два стиля: поэтически-метафорический и разговорно-практический

// --- МАТРИЦА КОНТЕНТА: ПОЭТИЧЕСКИ-МЕТАФОРИЧЕСКИЙ СТИЛЬ ---
const poeticContentMatrix = {
  'Дерево': {
    weak: {
      forecast: "Год Укоренения. Ваше время — не для рывка ввысь, а для того, чтобы пустить глубокие и терпеливые корни в почву вашей жизни, подобно древнему дубу, который сначала укрепляется в земле, прежде чем тянуться к небу.",
      energy: "Тишиной и мудростью планирования. Сила может прийти через осознание, куда вы на самом деле хотите расти, словно семя, которое знает своё предназначение ещё до того, как прорастёт.",
      advice: "Направьте заботу на фундамент: здоровье, ритм дня, круг самых близких. Может быть полезно отказаться от того, что истощает вашу почву, подобно садовнику, который убирает сорняки, чтобы дать ростку больше сил.",
      ritual: "Заведите «Дневник роста»: раз в неделю записывайте одно маленькое, но устойчивое изменение к лучшему. Цените процесс, а не высоту, словно наблюдая за медленным, но верным ростом дерева, которое день за днём становится крепче.",
      transformation: "Этот период закладывает несокрушимую внутреннюю устойчивость. К концу года вы можете ощутить, как терпение превратилось в глубинную уверенность — способность держаться за свою правду при любых обстоятельствах. Вы строите жизнь на прочном фундаменте, а не на зыбком песке, подобно дереву, чьи корни уходят глубоко в землю, делая его непоколебимым перед любыми бурями."
    },
    medium: {
      forecast: "Год Прорастания. Энергии года, словно солнце и дождь, могут питать ваши планы. Это время, чтобы смело сажать семена будущего и учиться доверять естественному ходу вещей.",
      energy: "Смелостью начинать и гибкостью следовать за светом. У вас могут найтись силы и ясность, чтобы пробиться к свету.",
      advice: "Сфокусируйтесь на одном главном начинании, дайте ему пространство. Вам могут помочь гибкие формы, а не жёсткие рамки.",
      ritual: "Создайте «Карту желаемого роста»: визуальный образ того, как могло бы выглядеть ваше «дерево» к концу года — его крона, корни, плоды.",
      transformation: "Вы становитесь садовником своей судьбы. Каждое действие — это уход за будущим урожаем. К концу года вы сможете увидеть, как ваши усилия принесли первые, осязаемые и вдохновляющие плоды, укрепляя веру в собственные силы. Ваше дерево растёт, и вы растёте вместе с ним."
    },
    strong: {
      forecast: "Год Цветения и Лидерства. Вы можете ощутить мощный подъём жизненной силы, словно весенний взрыв зелени после долгой зимы. Ваша энергия может стать подобна кроне зрелого дерева: дающей опору и требующей простора, простирающейся широко, чтобы защитить всех, кто ищет убежища под её ветвями.",
      energy: "Уверенностью вести за собой и ответственностью за свой «лес». Ваша сила может проявиться через щедрость — способность давать «тень» и «плоды», подобно дереву, которое не только растёт само, но и создаёт целую экосистему вокруг себя.",
      advice: "Направьте изобилие энергии на преодоление давней преграды или поддержку того, что выростило вас. Старайтесь избегать излишней прямолинейности («вырубки») на своём пути, помня, что даже самое могучее дерево умеет гнуться под ветром, не ломаясь.",
      ritual: "Практикуйте «Энергетический обмен»: на каждое потраченное на дело усилие находите момент покоя у воды или с книгой, чтобы восстановить соки, подобно дереву, которое впитывает влагу корнями, чтобы питать свои ветви.",
      transformation: "Ваша сила становится ресурсом для целого «леса». Помогая другим расти, вы умножаете и свою силу, словно дерево, которое, давая тень и плоды, само становится ещё крепче. К концу года вы можете обнаружить, что стали естественным лидером и опорой — к вам идут за советом, а ваши решения приносят пользу многим. Это путь к настоящему наследию, подобно вековому дубу, который переживёт не одно поколение."
    }
  },
  'Огонь': {
    weak: {
      forecast: "Год Зажжённой Искры. Год может осторожно раздувать ваше внутреннее пламя, подобно ветру, который разжигает тлеющие угли. Ваша задача — бережно хранить то, что даёт вам тепло и интерес к жизни, словно хранитель священного огня, защищающий его от угасания.",
      energy: "Поиском вдохновения в малом и благодарностью за моменты тихой радости. Ваш свет может быть ценен своей искренностью, подобно свече, которая, будучи маленькой, способна осветить целую комнату.",
      advice: "Ищите и создавайте уютные, тёплые ритуалы (утренний чай, разговор при свечах). Может помочь отказ от «сквозняков» суеты и токсичного общения, подобно тому, как защищают пламя от ветра, чтобы оно не погасло.",
      ritual: "Создайте «Алтарь радости» — уголок с изображениями, цитатами, предметами, которые заставляют вас мягко улыбнуться. Пусть это место станет вашим святилищем света, где ваша искра может безопасно гореть и набираться сил.",
      transformation: "Защищая своё пламя, вы открываете уникальный внутренний источник света. К концу года эта искра может превратиться в стабильное, тёплое сияние — вашу личную способность создавать уют и вдохновение в любой ситуации, независимо от внешних обстоятельств, подобно очагу, который согревает всех, кто к нему приближается."
    },
    medium: {
      forecast: "Год Яркого Пламени. Ваш внутренний свет может гореть ровно и притягательно, подобно костру, вокруг которого собираются путники в холодную ночь. Это время для творчества, сердечного общения и деления теплом, словно солнце, которое щедро дарит свой свет всем живым существам.",
      energy: "Легкостью бытия и щедростью души. Вы можете заметить, как к вам чаще приходят хорошие события, когда вы излучаете доброжелательность, подобно магниту, притягивающему к себе всё светлое и доброе.",
      advice: "Делитесь своим теплом: хвалите, вдохновляйте, собирайте людей вокруг красоты и добрых дел. Вы можете стать солнцем в своём кругу, тем, кто освещает путь другим и согревает их своим присутствием.",
      ritual: "Устройте «Неделю искренних комплиментов»: каждый день находите повод отметить что-то прекрасное в близком человеке и говорите ему об этом. Пусть ваши слова станут солнечными лучами, согревающими сердца, словно первые лучи рассвета, пробуждающие мир от ночного сна.",
      transformation: "Ваша теплота становится магнитом для прекрасного. Даря поддержку, вы создаёте круговорот добра, подобно солнцу, которое, отдавая свет, само становится ещё ярче. К концу года вы можете стать сердцем своего сообщества — тем, вокруг кого собираются, чтобы почувствовать принятие, вдохновение и радость бытия, словно вокруг костра, который объединяет всех в едином тепле."
    },
    strong: {
      forecast: "Год Солнечного Пика. Ваша энергия может быть на максимуме, словно полуденное солнце в зените, вы можете оказаться в центре внимания, подобно звезде, вокруг которой вращаются планеты. Год требует мудрого обращения с силой, чтобы не перегореть и не опалить других, помня, что даже самое яркое солнце нуждается в закате, чтобы восстановить силы.",
      energy: "Силой влияния и страстью к свершениям. Вы можете вести за собой, подобно факелу, освещающему путь в темноте, но важно помнить о ресурсах — своих и чужих, словно костёр, который нужно подпитывать, чтобы он не угас.",
      advice: "Направьте мощную энергию в созидательные, чётко очерченные проекты. Вам может помочь «заземление» в спокойных, надёжных людях (элемент Земля), подобно тому, как огонь нуждается в твёрдом основании, чтобы гореть стабильно и безопасно.",
      ritual: "Введите правило «Огненной паузы»: перед важным решением или эмоциональной реакцией сделайте 5 глубоких вдохов-выдохов, представляя, как ваше пламя становится ровным, сосредоточенным лучом, способным осветить путь, не обжигая, словно лазер, который режет с хирургической точностью.",
      transformation: "Вы учитесь превращать стихию в инструмент созидания. Эта сила может осветить путь для многих, подобно маяку, который виден издалека и указывает путь заблудшим кораблям. К концу года вы можете достичь заслуженного признания и стать маяком — тем, чьи идеи и пример мотивируют других действовать смелее и ярче, словно пламя, которое зажигает другие факелы, не теряя при этом своей яркости."
    }
  },
  'Земля': {
    weak: {
      forecast: "Год Плодородной Целины. Год может дать питательную энергию для укрепления основ, подобно весенней почве, которая, будучи вспаханной и удобренной, готова принять семена. Ваше время — вспахивать, удобрять и засевать свою жизненную почву, словно терпеливый земледелец, который знает, что урожай придёт не сразу, но его труд не пропадёт даром.",
      energy: "Накоплением ресурсов и заботой о фундаменте (здоровье, дом, режим). Каждый маленький ритуал заботы о себе может стать семенем будущей стабильности, подобно тому, как каждое зёрнышко, посаженное в землю, может вырасти в могучее дерево.",
      advice: "Сосредоточьтесь на построении и укреплении одного самого важного «участка» вашей жизни. Доверяйте проверенным источникам, словно садовник, который выбирает лучшие семена для своего сада.",
      ritual: "Практика «Ежедневного камня»: каждый день кладите в прозрачную банку один камешек (или записывайте), символизирующий одно маленькое, но твёрдо выполненное дело. К концу года вы увидите, как эти камешки превратились в прочный фундамент, подобно тому, как из отдельных камней строится крепость.",
      transformation: "Вы инвестируете в капитал будущего спокойствия. Каждое маленькое усилие — кирпичик в стене вашей безопасности, подобно тому, как каждый камень в фундаменте делает здание прочнее. К концу года вы сможете оглянуться и увидеть прочный, обустроенный мир, созданный вашими руками, и почувствовать глубочайшее удовлетворение созидателя, словно архитектор, который видит, как его чертежи превратились в реальность."
    },
    medium: {
      forecast: "Год Гармоничного Сада. Вы можете стать центром притяжения и опорой, подобно старому дубу, под кроной которого находят приют многие. Это время пожинать плоды прошлых усилий, завершать дела и дарить близким чувство надёжного тыла, словно садовник, который наконец видит результаты своих многолетних трудов.",
      energy: "Глубоким удовлетворением от порядка и способностью создавать уют и безопасность для других. Ваша сила может проявиться в предсказуемом постоянстве, подобно земле, которая всегда остаётся твёрдой под ногами, какой бы бурной ни была погода.",
      advice: "Используйте свою стабильность, чтобы завершить долгострой, привести в идеальный порядок важное пространство или стать «тихой гаванью» для кого-то, подобно порту, который всегда готов принять уставшие корабли.",
      ritual: "Проведите «Церемонию завершения»: торжественно закройте один старый, висящий «хвост» (физический или эмоциональный), поблагодарив его за урок, словно садовник, который с благодарностью собирает последний урожай перед зимой.",
      transformation: "Ваша стабильность — это платформа для безопасного роста вас и ваших близких, подобно плодородной почве, на которой могут расти самые разные растения. К концу года вы можете ощутить себя мудрым хранителем очага, в пространстве которого царят мир, доверие и чувство защищённости. Вы создаёте не просто дом, а родовое гнездо, подобно дереву, которое переживёт не одно поколение и станет наследием для потомков."
    },
    strong: {
      forecast: "Год Незыблемой Горы. Вы можете чувствовать себя непоколебимо, подобно Эвересту, который стоит веками, невзирая на бури и землетрясения, но есть риск окаменеть. Год призывает использовать вашу силу для поддержки слабых и решения сложных, «каменистых» вопросов, словно гора, которая служит ориентиром для путников и защитой от ветров.",
      energy: "Терпением и невероятной выносливостью. Вы можете выдержать многое, подобно скале, которая выдерживает удары волн, но важно не давить своей массой, а быть опорой, подобно мосту, который несёт груз, не ломаясь.",
      advice: "Направьте свою энергию на то, чтобы нести груз ответственности (семейной, социальной) или медленно, но верно двигать «гору» старой проблемы, подобно леднику, который, двигаясь медленно, способен изменить ландшафт.",
      ritual: "Практика «Мягкого взгляда»: раз в день сознательно ищите красоту в чём-то хрупком, изменчивом, непостоянном (роса, облако, детский смех), чтобы развивать гибкость, помня, что даже самая твёрдая скала покрыта мхом и цветами, которые придают ей жизнь.",
      transformation: "Ваша непоколебимость становится даром для окружающих. Будучи опорой, вы закаляетесь сами, подобно горе, которая, выдерживая испытания, становится ещё прочнее. К концу года вы можете обрести мудрость и уважение, сравнимые с вековой скалой. К вам будут приходить не за силой, а за мудростью и надёжностью, словно к священной горе, на вершине которой открывается вид на вечность."
    }
  },
  'Металл': {
    weak: {
      forecast: "Год Заточки Инструмента. Ваша «сталь» сейчас может проходить закалку в огне испытаний. Год учит ценить качество над количеством, ясность малых целей над масштабом. Как мастер кузнец, вы оттачиваете свой меч в тишине, превращая сырую руду в острое лезвие.",
      energy: "Сосредоточением на главном и дисциплиной в малом. Ваша сила может расти от чётко очерченных обязательств перед самим собой, словно металл закаляется под ударами молота.",
      advice: "Сфокусируйтесь на оттачивании одного навыка или выполнении одного, но безупречного обязательства. Может помочь отсечение всего, что распыляет фокус — подобно тому, как кузнец отсекает всё лишнее, оставляя только суть.",
      ritual: "Заведите «Журнал ясности»: каждый вечер записывайте один чёткий вывод или решение, принятое за день. Это ваш ежедневный «удар молота по металлу» — каждый удар приближает вас к совершенству, превращая грубый металл в тонкое лезвие.",
      transformation: "Эта концентрация выковывает вашу личную «суперсилу». К концу года вы можете выйти из этого периода с кристальной ясностью ума и закалённой волей, которые станут вашим самым ценным активом и пропуском на новые уровни в любой сфере. Вы превратились из сырой руды в закалённую сталь."
    },
    medium: {
      forecast: "Год Чётких Граней. Ваш ум может стать яснее, как отполированное зеркало, решения — взвешенными, словно золото на весах. Это идеальное время для ревизии, расхламления и утверждения личных границ, подобно тому, как ювелир отделяет драгоценные камни от пустой породы.",
      energy: "Чувством справедливости и способностью отделять ценное от пустого. Вам может открыться умение видеть суть сквозь шелуху, словно рентгеновский взгляд, проникающий в самую суть вещей.",
      advice: "Проведите аудит жизни: что служит вашим истинным ценностям, а что — лишь балласт? Вы можете найти в себе смелость отказаться от второго, подобно алхимику, отделяющему золото от шлака.",
      ritual: "Практика «Эмоционального минимализма»: сознательно откажитесь на неделю от жалоб, сплетен и бесплодных споров. Наблюдайте за ясностью, которая может прийти, словно туман рассеивается, открывая чистый горизонт.",
      transformation: "Освобождая пространство, вы делаете его готовым для самого лучшего. Вы культивируете элегантную простоту, подобно мастеру, создающему шедевр из минимальных средств. К концу года вы можете прийти к осознанной и гармоничной жизни, где каждая вещь, мысль и отношение находятся на своём месте и служат вашим истинным ценностям, словно идеально настроенный инструмент."
    },
    strong: {
      forecast: "Год Меча Мудрости. Вы можете ощутить остроту и силу своей воли, словно легендарный клинок, закалённый в огне испытаний. Год требует мудрого применения лезвия — для защиты слабых, разрезания узлов проблем, а не для нанесения ран, подобно хирургу, использующему скальпель для исцеления.",
      energy: "Решительностью и силой духа. Вы можете оказаться способны на смелые поступки, но истинная сила — в контроле над остриём, словно мастер фехтования, знающий, когда нанести удар, а когда удержать меч в ножнах.",
      advice: "Направьте свою мощь на «рассечение» одной сложной, запутанной проблемы в вашей жизни. Старайтесь избегать резких суждений и цинизма, помня, что даже самый острый меч должен быть обёрнут в мягкие ножны, когда не используется.",
      ritual: "Практика «Округления краёв»: каждый день совершайте один маленький, неожиданно мягкий поступок (помощь, комплимент, прощение мелкой оплошности). Пусть ваша острота ума сочетается с мягкостью сердца, словно меч, обёрнутый в шёлк.",
      transformation: "Вы учитесь превращать остроту в хирургически точный инструмент созидания. Эта способность приносит решения там, где другие видят тупик, словно меч Экскалибур, рассекающий любые препятствия. К концу года вы можете обрести репутацию справедливого стратега, к которому обращаются в самых сложных ситуациях, и установить новые стандарты качества, став легендой в своём деле."
    }
  },
  'Вода': {
    weak: {
      forecast: "Год Тихого Родника. Ваш источник может нуждаться в покое, подобно подземному ключу, который набирается сил в тишине, прежде чем пробиться на поверхность. Год зовёт к тишине, созерцанию и накоплению мудрости изнутри, а не из шумного внешнего мира, словно родник, который черпает свою чистоту из глубины земли.",
      energy: "Глубоким слушанием — себя, природы, мудрых мыслей. Ваша сила может раскрыться в способности впитывать и хранить, а не изливать, подобно озеру, которое принимает в себя дождь и талый снег, накапливая живительную влагу.",
      advice: "Создайте вокруг себя защитный «берег» от информационного шума и эмоционально истощающих людей. Ищите знания, которые питают душу, словно родник, который ищет чистые источники для пополнения своих вод.",
      ritual: "Практика «Цифрового поста»: выделите один час в день, полностью отключив все гаджеты. Наблюдайте за течением своих мыслей, как за течением реки, которая, будучи спокойной, отражает небо и открывает глубину.",
      transformation: "Вы опускаетесь к своему внутреннему источнику, подобно ныряльщику, который погружается в глубину, чтобы найти жемчужину. Эта практика может открыть неиссякаемый колодец мудрости и спокойствия. К концу года вы сможете вернуться в мир, неся в себе глубинное понимание себя и своих истинных желаний, став своим главным советчиком, словно мудрец, который черпает ответы из собственной глубины."
    },
    medium: {
      forecast: "Год Плавной Реки. Вы можете найти путь, обтекая препятствия, подобно реке, которая, встречая на своём пути скалы, не останавливается, а находит обходной путь, становясь ещё красивее от изгибов. Это время для общения, учебы, путешествий и налаживания связей. Доверяйте своему течению, словно река, которая знает, куда она течёт, даже если путь извилист.",
      energy: "Адаптивностью и коммуникабельностью. Вы сможете легко находить общий язык с разными людьми и ситуациями, сохраняя внутренний стержень, подобно реке, которая принимает в себя притоки, не теряя при этом своей сути.",
      advice: "Позвольте себе исследовать новое русло: тему, навык, круг общения. Делитесь своими «водами» — опытом и идеями — с теми, кто в них нуждается, подобно реке, которая орошает поля и даёт жизнь всему, что растёт на её берегах.",
      ritual: "Практика «Вопросов вместо ответов»: в беседах больше задавайте глубокие, открытые вопросы. Вы сможете стать проводником, который помогает другим найти их собственный поток, подобно лоцману, который знает все изгибы реки и может безопасно провести по ней других.",
      transformation: "Ваша гибкость становится силой, которая сильнее жёсткости, подобно воде, которая, будучи мягкой, способна точить камень. Вы можете стать мостиком между мирами и людьми, словно река, которая соединяет разные берега. К концу года вы привнесёте в свою жизнь гармонию и взаимопонимание, а также поможете другим найти общий язык, подобно реке, которая объединяет всё, что находится на её берегах."
    },
    strong: {
      forecast: "Год Глубокого Океана. Ваша энергия может ощущаться бездонной, подобно океану, чья глубина скрывает тайны, недоступные поверхностному взгляду. Вы можете стать опорой и советчиком для многих, словно океан, который служит домом для бесчисленных существ и источником жизни для всей планеты. Год призывает к развитию внутренней глубины через анализ и сострадание, подобно океану, который, будучи глубоким, остаётся спокойным на поверхности.",
      energy: "Спокойной мощью и проницательностью. Вам может открыться видение скрытых течений и глубинных причин, словно океанограф, который видит то, что скрыто от обычного взгляда. Ваша задача — не поддаваться темным водоворотам эмоций, помня, что даже в самых глубоких водах есть свет.",
      advice: "Используйте свою глубину для помощи другим в навигации по их эмоциональным водам. Вы сможете стать тем, кто сохраняет спокойствие в шторм, подобно маяку, который стоит непоколебимо даже в самую сильную бурю, указывая путь заблудшим кораблям.",
      ritual: "Практика «Прилив и отлив»: сознательно чередуйте периоды активной социальной вовлечённости с периодами полного уединения для «осаждения» впечатлений, подобно океану, который следует естественному ритму приливов и отливов, очищаясь и обновляясь.",
      transformation: "Ваша глубина — это хранилище мудрости для многих, подобно океану, который хранит в себе память всех времён. Даря поддержку, вы не истощаетесь, а отдаёте то, чем богаты, словно океан, который, отдавая воду облакам, сам становится ещё чище. К концу года вы можете обрести роль уважаемого наставника или стратега, к которому приходят за советом в сложных жизненных ситуациях, доверяя вашей проницательности, подобно капитану, который знает все тайны океана и может безопасно провести через любые бури."
    }
  }
};

// --- МАТРИЦА КОНТЕНТА: РАЗГОВОРНО-ПРАКТИЧЕСКИЙ СТИЛЬ ---
const practicalContentMatrix = {
  'Дерево': {
    weak: {
      forecast: "Год укрепления основ. Время набраться сил и создать надёжную базу для будущего развития.",
      energy: "Ощущение спокойной уверенности в правильном направлении. Каждое маленькое действие укрепляет вашу позицию.",
      advice: "Уделите внимание основам: здоровью, распорядку дня, самым близким людям. Каждое улучшение в этих сферах — это инвестиция в ваше будущее.",
      ritual: "Недельный чек-лист: раз в неделю записывайте один маленький, но полезный шаг, который вы сделали для своего будущего. К концу года увидите, как много вы достигли.",
      transformation: "Этот период закладывает прочную внутреннюю устойчивость. К концу года вы почувствуете, как терпение превратилось в глубинную уверенность — способность держаться за свою правду при любых обстоятельствах. Вы создаёте прочную основу для жизни."
    },
    medium: {
      forecast: "Год удачных стартов и роста. Энергия года идеально поддерживает новые начинания. Можно смело браться за планы и наблюдать, как они развиваются.",
      energy: "Чувствуется смелость начать и гибкость подстраиваться под обстоятельства. Есть ясность и силы двигаться к цели.",
      advice: "Выберите один ключевой проект и сосредоточьтесь на нём. Разбейте большую цель на маленькие шаги и отмечайте каждый прогресс.",
      ritual: "Доска визуализации: создайте (хоть в Pinterest) подборку образов, как должен выглядеть ваш успех в этом деле через год. Дополняйте её новыми деталями.",
      transformation: "Вы развиваете способность систематически работать над целями. Каждое действие укрепляет вашу позицию. К концу года вы увидите конкретные результаты ваших усилий, что укрепит вашу уверенность в собственных силах."
    },
    strong: {
      forecast: "Год прорыва и влияния. Ощущается большой прилив сил. Вы можете вести за собой, ваша энергия заметна и притягательна для окружающих.",
      energy: "Уверенность в себе и чувство ответственности. Сила — в том, чтобы помогать другим расти и делиться результатами.",
      advice: "Используйте этот подъём, чтобы наконец решить давнюю масштабную задачу или поддержать общее дело. Станьте тем, кто организует и вдохновляет.",
      ritual: "Правило баланса: после каждого важного и энергозатратного дела находите время на полное спокойствие — просто посидеть в тишине или почитать.",
      transformation: "Ваша сила становится ресурсом для вашего окружения. Помогая другим развиваться, вы укрепляете и свою позицию. К концу года вы обнаружите, что стали естественным лидером и опорой — к вам обращаются за советом, а ваши решения приносят пользу многим."
    }
  },
  'Огонь': {
    weak: {
      forecast: "Год укрепления внутренней энергии. Год поддерживает вашу активность, приглашая бережно сохранять то, что даёт вам радость и интерес к жизни.",
      energy: "Поиск вдохновения в простых вещах и благодарность за хорошие моменты. Ваша ценность — в искренности и способности создавать комфорт.",
      advice: "Создавайте себе маленькие ежедневные удовольствия (вкусный чай, приятная музыка, комфортное освещение). Ищите занятия, которые пробуждают любопытство и интерес.",
      ritual: "Коллекция позитивного: заведите папку (в телефоне или реальную), куда будете собирать то, что поднимает настроение: фото, цитаты, открытки. Обращайтесь к ней для восстановления энергии.",
      transformation: "Защищая свою энергию, вы развиваете внутренний ресурс. К концу года этот ресурс может стать стабильным источником — вашей личной способностью создавать комфорт и вдохновение в любой ситуации."
    },
    medium: {
      forecast: "Год гармонии и позитивной энергии. Ваша внутренняя энергия стабильна и притягательна. Идеальное время для творчества, сердечного общения и щедрого обмена позитивом.",
      energy: "Лёгкость и желание делиться хорошим. Вы естественно привлекаете добрые события и людей своей открытостью.",
      advice: "Чаще хвалите, поддерживайте, собирайте друзей за приятными делами. Будьте центром позитивной энергии в своём кругу, создавая комфортную атмосферу.",
      ritual: "Челлендж доброты: неделю каждый день делайте один конкретный комплимент или маленькое доброе дело для другого человека. Наблюдайте, как это влияет на ваши отношения.",
      transformation: "Ваша позитивная энергия привлекает хорошие события. Даря поддержку, вы укрепляете связи. К концу года вы можете стать центром своего сообщества — тем, вокруг кого собираются, чтобы почувствовать принятие и радость."
    },
    strong: {
      forecast: "Год солнечного всплеска. Ваша энергия на максимуме, вы в центре внимания. Год дарит возможность сиять по-настоящему заметно и влиять на события.",
      energy: "Ощущение влияния и страсти к значимым свершениям. Вы можете вести за собой, направляя энергию в конструктивное русло.",
      advice: "Вложите энергию в один большой и ясный проект, который требует энтузиазма и лидерства. Ваша активность может вдохновить других на значимые действия.",
      ritual: "Пятиминутная пауза: перед важным разговором или решением остановитесь и 5 раз глубоко вдохните-выдохните, представляя, как ваша энергия становится сфокусированной и управляемой.",
      transformation: "Вы учитесь направлять энергию в конструктивное русло. Эта способность помогает вам влиять на других. К концу года вы можете достичь заслуженного признания и стать примером — тем, чьи идеи мотивируют других действовать смелее."
    }
  },
  'Земля': {
    weak: {
      forecast: "Год укрепления позиций. Время систематически работать над основами: здоровьем, бытом, финансами.",
      energy: "Фокус на накоплении ресурсов и заботе о себе. Каждый шаг к порядку даёт чувство защищённости и уверенности в будущем.",
      advice: "Выберите одну ключевую сферу жизни (например, дом или здоровье) и последовательно приведите её в порядок. Доверяйте проверенным, долгосрочным стратегиям.",
      ritual: "Банка достижений: каждый день кладите в банку записочку с одним маленьким, но твёрдо выполненным делом или поводом для благодарности. К концу года увидите накопленные результаты.",
      transformation: "Вы инвестируете в будущую стабильность. Каждое маленькое усилие укрепляет вашу позицию. К концу года вы сможете оглянуться и увидеть упорядоченную систему, созданную вашими усилиями."
    },
    medium: {
      forecast: "Год получения результатов. Вы — естественный центр притяжения и опора. Время использовать результаты прошлых усилий и дарить близким чувство надёжной поддержки.",
      energy: "Удовлетворение от наведённого порядка и способность создавать для близких ощущение безопасности и комфорта.",
      advice: "Используйте эту стабильность, чтобы завершить долгострой, привести в идеальный порядок важное пространство или стать надёжной поддержкой для кого-то.",
      ritual: "Ритуал закрытия: символически завершите одно давно висящее дело (проект, обязательство, неразрешённую ситуацию). Поблагодарите его за урок и освободите место новому.",
      transformation: "Ваша стабильность — это платформа для безопасного развития вас и ваших близких. К концу года вы можете ощутить себя надёжным центром, в пространстве которого царят порядок, доверие и чувство защищённости."
    },
    strong: {
      forecast: "Год прочной позиции. Вы чувствуете свою мощь и выносливость. Год призывает использовать эту силу для поддержки других и решения сложных вопросов.",
      energy: "Большое терпение и значительная внутренняя сила. Вы способны выдержать многое и стать опорой для многих.",
      advice: "Направьте свою энергию на то, чтобы нести ответственность за важную задачу или помогать другим преодолевать их трудности. Ваша сила — в умении доводить до конца.",
      ritual: "Упражнение на гибкость: раз в день намеренно обращайте внимание на что-то мимолётное и красивое (природные явления, движение облаков), развивая способность к адаптации.",
      transformation: "Ваша устойчивость становится ресурсом для окружающих. Будучи опорой, вы укрепляетесь сами. К концу года вы можете обрести мудрость и уважение, основанные на надёжности и последовательности."
    }
  },
  'Металл': {
    weak: {
      forecast: "Год фокусировки на качестве. Ваше время — сфокусироваться на одном ключевом умении, развивая его систематически.",
      energy: "Внутренняя концентрация и дисциплина. Сила растёт, когда вы доводите до конца даже маленькие обязательства перед самим собой.",
      advice: "Выберите один навык для развития или одно важное обязательство перед собой. Посвящайте ему регулярные, пусть и небольшие, промежутки времени.",
      ritual: "Дневник решений: каждый вечер записывайте один чёткий вывод, решение или инсайт дня. Это ваша ежедневная практика, развивающая ясность мышления.",
      transformation: "Эта концентрация развивает вашу ключевую компетенцию. К концу года вы можете выйти из этого периода с ясностью ума и укреплённой волей, которые станут вашим самым ценным активом."
    },
    medium: {
      forecast: "Год ясности и чёткости. Ваш ум ясен, решения взвешены. Идеальное время для ревизии, расхламления и утверждения того, что вы по-настоящему цените.",
      energy: "Обострённое чувство справедливости и способность отделять ценное от пустого. Вы понимаете, что для вас ценно.",
      advice: "Проведите аудит жизни в ключевых сферах (финансы, отношения, обязательства). С благодарностью отпустите то, что отслужило своё, и чётко обозначьте границы.",
      ritual: "Неделя чистоты речи: попробуйте неделю не жаловаться, не сплетничать и не вступать в бесполезные споры. Наблюдайте за ясностью и спокойствием, которые приходят.",
      transformation: "Освобождая пространство, вы делаете его готовым для самого лучшего. К концу года вы можете прийти к осознанной и гармоничной жизни, где каждая вещь, мысль и отношение находятся на своём месте."
    },
    strong: {
      forecast: "Год ясного мышления и решительности. Вы ощущаете остроту ума и силу воли. Год даёт возможность направить эту способность на решение масштабных задач и защиту справедливости.",
      energy: "Решительность и сила духа, способная решать самые сложные проблемы. Вы учитесь использовать ясность мышления как инструмент созидания.",
      advice: "Направьте свою мощь на решение одного запутанного, давнего вопроса в вашей жизни или профессиональной сфере. Действуйте стратегически, а не импульсивно.",
      ritual: "Тренировка баланса: каждый день делайте одно маленькое, неожиданно мягкое действие (помощь без напоминания, искренний комплимент, прощение мелкой оплошности).",
      transformation: "Вы учитесь использовать ясность мышления как точный инструмент решения проблем. Эта способность приносит решения там, где другие видят тупик. К концу года вы можете обрести репутацию справедливого стратега, к которому обращаются в самых сложных ситуациях."
    }
  },
  'Вода': {
    weak: {
      forecast: "Год накопления внутренних ресурсов. Год зовёт к бережному накоплению сил через тишину и размышления.",
      energy: "Потребность в тишине и глубоком понимании. Вы восстанавливаетесь, когда слушаете, читаете, размышляете, развивая свой внутренний ресурс.",
      advice: "Создайте вокруг себя защищённое пространство от информационного шума. Ищите знания и общение, которые развивают вас, а не истощают.",
      ritual: "Цифровой детокс: выделяйте один час в день (или один день в неделю) для полного отключения от гаджетов и новостей. Наблюдайте за своими мыслями.",
      transformation: "Вы развиваете свой внутренний ресурс. Эта практика может открыть источник мудрости и спокойствия. К концу года вы сможете вернуться в мир, неся в себе глубокое понимание себя и своих истинных желаний."
    },
    medium: {
      forecast: "Год адаптивности и коммуникации. Вы находите свой путь, гибко преодолевая препятствия. Прекрасное время для общения, учёбы и налаживания прочных связей.",
      energy: "Гибкость и способность к коммуникации. Вы легко находите общий язык, сохраняя свою суть, становясь связующим звеном.",
      advice: "Позвольте себе исследовать новые направления — тему, навык, круг общения. Делитесь своим опытом и слушайте истории других.",
      ritual: "Практика вопросов: в разговорах попробуйте больше задавать глубокие, открытые вопросы. Будьте тем, кто помогает другим осознать их собственные мысли.",
      transformation: "Ваша гибкость становится силой, которая сильнее жёсткости. Вы можете стать связующим звеном между разными людьми и группами. К концу года вы привнесёте в свою жизнь гармонию и взаимопонимание, а также поможете другим найти общий язык."
    },
    strong: {
      forecast: "Год глубокого понимания и стабильности. Ваша мудрость и проницательность достигают высокого уровня. Вы можете быть опорой и проводником для многих.",
      energy: "Спокойная мощь и способность видеть скрытые причины событий. Вы храните мудрость для многих.",
      advice: "Используйте свою способность к глубокому анализу, чтобы помогать другим разбираться в сложных ситуациях — давать взвешенные советы или просто быть тем, кто сохраняет спокойствие в кризисных моментах.",
      ritual: "Режим баланса: сознательно чередуйте периоды активной социальной вовлечённости с периодами полного уединения для обработки впечатлений и восстановления сил.",
      transformation: "Ваша способность к глубокому пониманию — это ресурс для многих. Даря поддержку, вы не истощаетесь, а используете то, чем богаты. К концу года вы можете обрести роль уважаемого наставника или стратега, к которому приходят за советом в сложных жизненных ситуациях."
    }
  }
};

// --- ФУНКЦИЯ ДЛЯ ВЫЧИСЛЕНИЯ ОПАСНЫХ МЕСЯЦЕВ ---
/**
 * Вычисляет опасные месяцы на основе элемента дня
 * Опасные месяцы - это месяцы контролирующего элемента
 */
function getDangerousMonths(dayMasterElement) {
  const dangerousMonthsMap = {
    'Дерево': {
      branches: ['申', '酉', '戌'],
      names: ['申 (август)', '酉 (сентябрь)', '戌 (октябрь)'],
      months: 'август-октябрь',
      element: 'Металл'
    },
    'Огонь': {
      branches: ['亥', '子', '丑'],
      names: ['亥 (ноябрь)', '子 (декабрь)', '丑 (январь)'],
      months: 'ноябрь-январь',
      element: 'Вода'
    },
    'Земля': {
      branches: ['寅', '卯', '辰'],
      names: ['寅 (февраль)', '卯 (март)', '辰 (апрель)'],
      months: 'февраль-апрель',
      element: 'Дерево'
    },
    'Металл': {
      branches: ['巳', '午', '未'],
      names: ['巳 (май)', '午 (июнь)', '未 (июль)'],
      months: 'май-июль',
      element: 'Огонь'
    },
    'Вода': {
      branches: ['辰', '戌', '丑', '未'],
      names: ['辰 (апрель)', '戌 (октябрь)', '丑 (январь)', '未 (июль)'],
      months: 'апрель, июль, октябрь, январь',
      element: 'Земля'
    }
  };
  
  return dangerousMonthsMap[dayMasterElement] || dangerousMonthsMap['Дерево'];
}

// --- СОВЕТЫ ДЛЯ СОЗДАНИЯ АМУЛЕТА ---
const amuletCreationAdvice = {
  'Дерево': {
    element: 'Дерево',
    symbol: 'росток, дерево, лист, бамбук',
    colors: 'зелёный, изумрудный, салатовый',
    materials: 'дерево, зелёная яшма, нефрит, зелёный агат'
  },
  'Огонь': {
    element: 'Огонь',
    symbol: 'солнце, пламя, феникс, дракон',
    colors: 'красный, оранжевый, розовый',
    materials: 'красный агат, рубин, красная яшма, керамика'
  },
  'Земля': {
    element: 'Земля',
    symbol: 'гора, кристалл, квадрат, земной шар',
    colors: 'жёлтый, коричневый, бежевый, терракотовый',
    materials: 'керамика, фарфор, пирит, жёлтая яшма, янтарь'
  },
  'Металл': {
    element: 'Металл',
    symbol: 'монета, меч, круг, металлический предмет',
    colors: 'белый, золотой, серебряный, серый',
    materials: 'металл, золото, серебро, белая яшма, жемчуг'
  },
  'Вода': {
    element: 'Вода',
    symbol: 'волна, капля, рыба, черепаха',
    colors: 'синий, чёрный, тёмно-синий, индиго',
    materials: 'гематит, чёрная яшма, сапфир, аквамарин'
  }
};

// ============================================
// РАСШИРЕННАЯ БИБЛИОТЕКА РЕКОМЕНДАЦИЙ BAZI NAVIGATOR
// ============================================

// --- БАЗОВЫЕ АРХЕТИПЫ ДЛЯ КАЖДОГО ЭЛЕМЕНТА (3 варианта) ---
const elementBaseTemplates = {
  'Дерево': [
    {
      id: 'wood_1',
      aspect: 'Дерево-Бамбук',
      theme: 'Гибкость, устойчивость, рост в любых условиях',
      amulet: "Браслет из бамбуковых сегментов или зелёной яшмы в форме ростка. Символ — бамбук, ива, тростник.",
      action: "Практикуйте гибкость в мыслях и действиях. Как бамбук гнётся под ветром, но не ломается — адаптируйтесь к изменениям, сохраняя стержень. Начните что-то выращивать (растения, проект, навык).",
      healthFocus: "Печень, желчный пузырь, глаза, сухожилия.",
      healthAdvice: "Делайте перерывы при работе за компьютером, практикуйте упражнения на растяжку, включайте в рацион зелёные овощи."
    },
    {
      id: 'wood_2',
      aspect: 'Дерево-Дуб',
      theme: 'Прочность, защита, стабильный рост',
      amulet: "Кулон из дубовой древесины или тёмно-зелёного нефрита. Символ — могучее дерево, корни, щит.",
      action: "Укрепляйте фундамент. Проанализируйте, на чём держатся ваши основные сферы жизни (здоровье, финансы, отношения). Создайте «корневую систему» — системы, привычки, запасы.",
      healthFocus: "Позвоночник, ногти, зрение.",
      healthAdvice: "Уделяйте внимание осанке, укрепляйте мышцы спины, практикуйте смотрение вдаль (противодействие близорукости)."
    },
    {
      id: 'wood_3',
      aspect: 'Дерево-Цветение',
      theme: 'Расцвет, творчество, вдохновение',
      amulet: "Подвеска в форме цветка (сакуры, лотоса) из розового кварца или зелёного агата. Символ — цветущая ветка, бутон, сад.",
      action: "Позвольте себе «цвести». Займитесь тем, что давно откладывали из страха осуждения или неидеальности. Делитесь своими идеями и творчеством с миром, даже небольшим кругом.",
      healthFocus: "Циклы (у женщин), гормональный баланс, эмоциональное состояние.",
      healthAdvice: "Следите за циклом сна и бодрствования. Практикуйте арт-терапию, ведите дневник эмоций."
    }
  ],
  'Огонь': [
    {
      id: 'fire_1',
      aspect: 'Огонь-Солнце',
      theme: 'Яркость, лидерство, щедрость, видение',
      amulet: "Кулон в форме солнца или диск из красной яшмы/карнеола. Символ — солнце, ореол, корона.",
      action: "Сияйте, не опаляя. Проявляйте лидерские качества, вдохновляйте других своим видением. Будьте щедры на похвалу и поддержку. Ваша задача — освещать путь, а не ослеплять.",
      healthFocus: "Сердечно-сосудистая система, глаза, давление.",
      healthAdvice: "Контролируйте давление, избегайте перегрева (как физического, так и эмоционального). Носите качественные солнцезащитные очки."
    },
    {
      id: 'fire_2',
      aspect: 'Огонь-Очаг',
      theme: 'Тепло дома, близость, уют, питание',
      amulet: "Подвеска в форме пламени или сердца из розового кварца или красного агата. Символ — домашний очаг, свеча, сердце.",
      action: "Согревайте свой круг. Уделите время семье, близким друзьям. Создайте уютное пространство, где людям хорошо. Готовьте для других, собирайте гостей. Ваша сила — в создании тепла и безопасности.",
      healthFocus: "Тонкий кишечник, система пищеварения, эмоциональное тепло.",
      healthAdvice: "Питайтесь тёплой пищей, избегайте холодных напитков. Развивайте способность принимать и давать любовь."
    },
    {
      id: 'fire_3',
      aspect: 'Огонь-Факел',
      theme: 'Идеи, вдохновение, творчество, передача огня',
      amulet: "Браслет из красного стекла или граната, факелообразная подвеска. Символ — факел, молния, лампочка.",
      action: "Несите свой огонь в мир. Занимайтесь творчеством, делитесь идеями, учите других. Ваша задача — зажигать искры вдохновения в окружающих. Пишите, выступайте, создавайте.",
      healthFocus: "Нервная система, бессонница, гиперактивность.",
      healthAdvice: "Давайте выход творческой энергии, иначе она может превратиться в тревогу. Практикуйте медитацию для успокоения ума."
    }
  ],
  'Земля': [
    {
      id: 'earth_1',
      aspect: 'Земля-Гора',
      theme: 'Стабильность, опора, непоколебимость',
      amulet: "Кулон в форме горы или кристалл пирита в жёлтой оправе. Символ — гора, скала, фундамент.",
      action: "Будьте опорой для других. Ваша сила — в непоколебимости и терпении. Поддерживайте тех, кто слабее. Создавайте структуры, которые переживут время.",
      healthFocus: "Желудок, селезёнка, мышцы, лимфатическая система.",
      healthAdvice: "Соблюдайте режим питания, избегайте переедания. Практикуйте силовые упражнения для укрепления мышц."
    },
    {
      id: 'earth_2',
      aspect: 'Земля-Поле',
      theme: 'Плодородие, забота, питание',
      amulet: "Подвеска в форме плода или керамический кулон с растительным орнаментом. Символ — поле, урожай, сад.",
      action: "Заботьтесь и питайте. Уделяйте внимание близким, создавайте уют. Ваша задача — сделать пространство вокруг плодородным для роста других. Инвестируйте в долгосрочное.",
      healthFocus: "Пищеварительная система, метаболизм, иммунитет.",
      healthAdvice: "Включите в рацион разнообразные продукты, избегайте однообразия. Практикуйте заботу о себе как ритуал."
    },
    {
      id: 'earth_3',
      aspect: 'Земля-Кристалл',
      theme: 'Преобразование, ценность, структура',
      amulet: "Кристалл пирита, янтарь или жёлтая яшма в геометрической оправе. Символ — кристалл, алмаз, структура.",
      action: "Преобразуйте хаос в порядок. Систематизируйте, организуйте, создавайте структуры. Ваша сила — в превращении сырого материала в ценность. Работайте над долгосрочными проектами.",
      healthFocus: "Костная система, суставы, соединительные ткани.",
      healthAdvice: "Укрепляйте кости через питание и упражнения. Избегайте застоя — движение сохраняет структуру."
    }
  ],
  'Металл': [
    {
      id: 'metal_1',
      aspect: 'Металл-Резец',
      theme: 'Ясность, границы, решительность',
      amulet: "Минималистичный браслет из стальных пластин или заточенный кристалл горного хрусталя. Символ — остриё, меч, скальпель.",
      action: "Практикуйте «ментальную заточку»: четко формулируйте мысли, отказывайтесь от неясных обязательств. Проведите ревизию личных границ — где вы говорите «да», когда нужно «нет»?",
      healthFocus: "Лёгкие, кожа, толстый кишечник.",
      healthAdvice: "Берегите лёгкие и кожу. Практикуйте дыхательные упражнения и увлажнение кожи. Осторожно с острыми предметами."
    },
    {
      id: 'metal_2',
      aspect: 'Металл-Монета',
      theme: 'Ценность, обмен, структура',
      amulet: "Подвеска в форме древней монеты (古钱) или кольцо с геометрической гравировкой. Символ — монета, весы, сейф.",
      action: "Проведите аудит ресурсов (время, деньги, энергия). Начните копить или инвестировать во что-то, что будет расти в цене — будь то навык или актив. Упростите финансовые потоки.",
      healthFocus: "Лёгкие, кожа, дыхательная система.",
      healthAdvice: "Внимание к кишечнику и лёгким. Избегайте пищи, вызывающей слизь. Дышите чистым воздухом."
    },
    {
      id: 'metal_3',
      aspect: 'Металл-Колокол',
      theme: 'Резонанс, коммуникация, чистота звука',
      amulet: "Брелок-бубенец из латуни или серебряные серёжки-колокольчики. Символ — колокол, камертон, эхо.",
      action: "Работайте с голосом и словами. Запишите подкаст, начните вести блог, практикуйте ясные и честные разговоры. «Очистите звучание» ваших сообщений миру. Слушайте, как звучат ваши фразы.",
      healthFocus: "Горло, голосовые связки, дыхание.",
      healthAdvice: "Берегите горло и голосовые связки. Пейте тёплые напитки, избегайте крика."
    }
  ],
  'Вода': [
    {
      id: 'water_1',
      aspect: 'Вода-Океан',
      theme: 'Мудрость, глубина, масштаб',
      amulet: "Браслет из гематита или сапфира, подвеска в форме волны. Символ — океан, глубина, бездна.",
      action: "Углубляйтесь в знания. Изучайте философию, психологию, историю. Ваша сила — в способности видеть глубинные связи. Делитесь мудростью с другими, будьте наставником.",
      healthFocus: "Почки, мочеполовая система, костный мозг.",
      healthAdvice: "Берегите почки, поддерживайте водный баланс. Избегайте переохлаждения. Практикуйте медитацию для внутреннего покоя."
    },
    {
      id: 'water_2',
      aspect: 'Вода-Ручей',
      theme: 'Гибкость, адаптация, течение',
      amulet: "Подвеска в форме капли или браслет из аквамарина. Символ — ручей, поток, извилистая река.",
      action: "Теките, обтекая препятствия. Адаптируйтесь к обстоятельствам, не теряя цели. Ваша сила — в гибкости и коммуникабельности. Путешествуйте, общайтесь, учитесь новому.",
      healthFocus: "Кровеносная система, лимфа, гибкость суставов.",
      healthAdvice: "Поддерживайте циркуляцию через движение. Пейте достаточно воды. Практикуйте растяжку для гибкости."
    },
    {
      id: 'water_3',
      aspect: 'Вода-Родник',
      theme: 'Чистота, источник, обновление',
      amulet: "Кристалл горного хрусталя или прозрачный кварц в форме капли. Символ — родник, источник, чистая вода.",
      action: "Очищайте и обновляйте. Проведите детоксикацию — физическую (питание, среда) и ментальную (привычки, отношения). Ваша задача — сохранять чистоту источника, из которого черпают другие.",
      healthFocus: "Почки, мочевой пузырь, очистительные системы.",
      healthAdvice: "Практикуйте очистительные практики (детокс, медитация, цифровой пост). Берегите почки, избегайте токсинов."
    }
  ]
};

// --- МОДИФИКАТОРЫ СИЛЫ ДЛЯ ВСЕХ ЭЛЕМЕНТОВ (5 градаций) ---
const elementStrengthModifiers = {
  'Дерево': {
    'Очень слабый (0-1)': {
      amulet: "Ваше Дерево нуждается в обильном питании (Вода) и поддержке (Земля). Используйте амулет из комбинации материалов: Дерево (деревянная основа) + Вода (синий/чёрный камень) или Дерево + Земля (жёлтый камень в деревянной оправе).",
      action: "Сосредоточьтесь на восстановлении ресурсов. Избегайте конфликтов и давления. Это год «инкубации» — накапливайте знания, отдыхайте, ищите поддержку у мудрых наставников (Вода) или стабильных структур (Земля).",
      colors: "Основные цвета: все оттенки зелёного. Для поддержки: синий, чёрный (Вода) и жёлтый, коричневый (Земля)."
    },
    'Слабый (1-2)': {
      amulet: "Ваше Дерево нуждается в поддержке и питательной среде. Используйте амулет из Дерева с элементами Воды. Например, деревянный браслет с вставками из гематита или аквамарина.",
      action: "Растите постепенно. Ставьте небольшие, достижимые цели. Ищите «плодородную почву» — среду, где вас поддерживают. Практикуйте регулярные, маленькие действия (полив ростка).",
      colors: "Зелёный + синий/чёрный (Вода) для питания."
    },
    'Сбалансированный (2-4)': {
      amulet: "Амулет может быть чистым Деревом или из зелёных камней (яшма, нефрит). Форма должна соответствовать архетипу (гибкий бамбук, крепкий дуб, цветущая ветка).",
      action: "Действуйте в соответствии с вашим архетипом. Вы можете позволить себе как активный рост, так и период созерцания. Главное — сохранять движение.",
      colors: "Все оттенки зелёного. Акценты цвета благоприятных элементов."
    },
    'Сильный (4-5)': {
      amulet: "Добавьте к деревянному амулету элементы Металла (металлические вставки, белые камни). Это создаст баланс и направит энергию.",
      action: "Ваша энергия и амбиции на пике. Направьте их на масштабные проекты, помощь другим (особенно тем, кто слабее). Избегайте излишней прямолинейности и упрямства — учитесь искусству компромисса (Металл как секатор).",
      colors: "Зелёный + белый, металлик (Металл) для контроля и фокуса."
    },
    'Очень сильный (5+)': {
      amulet: "Амулет, где Металл (контроль) преобладает над Деревом. Например, металлический браслет с деревянными вставками. Можно добавить Огонь (красный) для отвода энергии через творчество.",
      action: "Год обучения смирению и стратегии. Ваша сила может пугать или ломать. Учитесь её сдерживать, направлять в созидательное русло. Помогайте другим расти, становитесь покровителем, а не конкурентом.",
      colors: "Меньше зелёного, больше белого/металлика (Металл) и красного (Огонь для рассеивания)."
    }
  },
  'Огонь': {
    'Очень слабый (0-1)': {
      amulet: "Ваш Огонь нуждается в топливе (Дерево) и защите от ветра (Земля). Используйте амулет из комбинации: Огонь (красный камень) + Дерево (зелёные вставки) для питания. Можно добавить Землю (жёлтый) для стабильности пламени.",
      action: "Берегите своё пламя. Избегайте ситуаций, где вас могут «задуть» критикой или холодным отношением. Ищите «топливо» — вдохновляющие книги, людей, места. Это год разведения маленького, но устойчивого костра.",
      colors: "Красный + зелёный (Дерево) для поддержки. Жёлтый (Земля) для защиты."
    },
    'Слабый (1-2)': {
      amulet: "Ваш Огонь требует добавления топлива. Используйте амулет с преобладанием красного (Огонь) и зелёного (Дерево) цветов.",
      action: "Подпитывайте свою страсть и энтузиазм. Занимайтесь тем, что «зажигает». Окружайте себя людьми, которые верят в вас. Действуйте маленькими, но регулярными шагами.",
      colors: "Красный, оранжевый + зелёный (Дерево)."
    },
    'Сбалансированный (2-4)': {
      amulet: "Амулет из красных камней (рубин, гранат, красная яшма) в форме, соответствующей архетипу.",
      action: "Горите ровным пламенем. Вы можете и дарить тепло, и творить, и вести за собой — в зависимости от выбранного архетипа. Контролируйте интенсивность.",
      colors: "Красный, оранжевый, розовый."
    },
    'Сильный (4-5)': {
      amulet: "Добавьте к красному амулету элементы Воды (синие/чёрные камни) или Металла (белые камни, металл). Это охладит и направит энергию.",
      action: "Ваша энергия и харизма на высоте. Используйте их для масштабных проектов, публичных выступлений. Остерегайтесь перегрева, нетерпимости, эгоцентризма. Пейте больше воды (буквально и метафорически).",
      colors: "Красный + синий/чёрный (Вода) для контроля. Можно добавить белый (Металл)."
    },
    'Очень сильный (5+)': {
      amulet: "Амулет, где Вода (контроль) преобладает над Огнём. Например, синий камень (аквамарин, сапфир) с красными вкраплениями. Или металлический амулет, рассеивающий жар.",
      action: "Год обучения сдержанности. Ваш жар может обжигать. Учитесь слушать больше, чем говорить. Направляйте колоссальную энергию в системную работу, спорт, помощь в кризисных ситуациях (где нужен героизм).",
      colors: "Минимум красного. Акцент на синем, чёрном (Вода), белом, металлике (Металл)."
    }
  },
  'Земля': {
    'Очень слабый (0-1)': {
      amulet: "Ваша Земля нуждается в Огне (поддержка) и Металле (структура). Используйте амулет из комбинации: Земля (керамика, жёлтый камень) + Огонь (красные вставки) или Земля + Металл (металлические элементы).",
      action: "Укрепляйте фундамент. Ищите поддержку у энергичных людей (Огонь) и структурированных систем (Металл). Это год накопления — создавайте запас прочности во всех сферах.",
      colors: "Жёлтый, коричневый + красный (Огонь) и белый, металлик (Металл)."
    },
    'Слабый (1-2)': {
      amulet: "Используйте амулет из Земли с элементами Огня. Например, керамический кулон с красными вставками или жёлтый камень с огненными акцентами.",
      action: "Создавайте стабильность постепенно. Ищите «топливо» для вашей Земли — энтузиазм, цели, мотивацию (Огонь). Практикуйте регулярность и порядок.",
      colors: "Жёлтый, коричневый + красный, оранжевый (Огонь)."
    },
    'Сбалансированный (2-4)': {
      amulet: "Амулет из земных материалов (керамика, фарфор, жёлтые камни) в форме, соответствующей архетипу.",
      action: "Действуйте в соответствии с вашим архетипом. Вы можете и создавать структуры, и заботиться, и преобразовывать — в зависимости от выбранного пути.",
      colors: "Жёлтый, коричневый, бежевый, терракотовый."
    },
    'Сильный (4-5)': {
      amulet: "Добавьте к земному амулету элементы Дерева (зелёные вставки) или Воды (синие камни). Это добавит гибкости и движения.",
      action: "Ваша стабильность — сила. Используйте её для поддержки других и создания долгосрочных структур. Избегайте застоя и упрямства — добавляйте гибкость (Дерево) и движение (Вода).",
      colors: "Жёлтый, коричневый + зелёный (Дерево) или синий, чёрный (Вода)."
    },
    'Очень сильный (5+)': {
      amulet: "Амулет, где Дерево (гибкость) или Вода (движение) преобладают над Землёй. Например, зелёный камень с жёлтыми вставками или синий с земными акцентами.",
      action: "Год обучения гибкости и движению. Ваша непоколебимость может превратиться в окаменелость. Учитесь адаптироваться, меняться, делиться ресурсами. Помогайте другим, но не давите своей массой.",
      colors: "Меньше жёлтого/коричневого, больше зелёного (Дерево) или синего/чёрного (Вода)."
    }
  },
  'Металл': {
    'Очень слабый (0-1)': {
      amulet: "Ваш Металл нуждается в поддержке. Используйте амулет из СЛИВАЮЩИХСЯ материалов: Металл, усиленный Землёй (например, посеребренная керамика, металл с жёлтым топазом). Земля будет рождать и укреплять ваш Металл. Избегайте одиноких символов — пусть амулет будет парным или иметь двойную природу.",
      action: "Сознательно ищите поддержки, наставников, прочной основы (Земля). Избегайте самостоятельных резких действий. Это год «накопления потенциала» — учитесь, копите ресурсы, укрепляйте здоровье. Ваша стратегия — быть в команде, за спиной у надежного партнёра.",
      colors: "Основные цвета: белый, металлик. Для поддержки: добавляйте жёлтый, коричневый, терракотовый (Земля)."
    },
    'Слабый (1-2)': {
      amulet: "Ваш Металл требует укрепления. Используйте амулет из ПОДДЕРЖИВАЮЩИХ материалов: Металл + Земля. Добавьте символ горы, кристалла или прямоугольной формы. Можно носить два амулета: один металлический, один земной (керамический).",
      action: "Укрепляйте фундамент: здоровье, базовые навыки, сбережения. Действуйте в союзе с надежными людьми. Не берите на себя слишком много — делите ответственность. Практикуйте регулярность и дисциплину в малом.",
      colors: "Основные цвета: белый, металлик. Для поддержки: жёлтый, коричневый, бежевый (Земля)."
    },
    'Сбалансированный (2-4)': {
      amulet: "Амулет может быть чистым Металлом. Главное — его форма и символизм, соответствующие вашему архетипу (Резец, Монета, Колокол). Выберите то, что резонирует с вашей целью на год.",
      action: "Действуйте в соответствии с выбранным архетипом. У вас есть энергия и для действия, и для осмысления. Вы можете позволить себе быть гибким: иногда проявлять твёрдость (Металл), иногда — уступать (под контролем).",
      colors: "Основные цвета: белый, металлик, серый. Можно добавлять акценты цвета благоприятных элементов."
    },
    'Сильный (4-5)': {
      amulet: "Добавьте к амулету ОГРАНИЧИВАЮЩИЙ элемент: Огонь (например, вставку из красного камня — рубин, гранат) или Воду (синий сапфир, аквамарин). Огонь будет контролировать и направлять избыток Металла, превращая его в изящный инструмент. Вода — показывать гибкость.",
      action: "Ваша энергия требует выхода. Направьте её на амбициозные проекты, помощь другим, дисциплину. Избегайте критики и резкости — преобразуйте силу в мастерство. Учитесь мягкости: иногда достаточно намёка, а не приказа.",
      colors: "Основные цвета: белый, металлик. Для баланса: добавляйте красный, оранжевый (Огонь) или синий, чёрный (Вода)."
    },
    'Очень сильный (5+)': {
      amulet: "Используйте амулет из СМЯГЧАЮЩИХ материалов: Металл с элементами Воды (голубой аквамарин в серебре) или Огня (красная эмаль на стали). Избегайте острых форм — выбирайте округлые, обтекаемые. Символы: волна, пламя, облако.",
      action: "Год обучения делегированию и гибкости. Избыток силы может ломать, а не строить. Учитесь не использовать всю свою мощь, находите красоту в простоте. Помогайте другим, но не давите. Практикуйте активное слушание.",
      colors: "Основные цвета: белый, металлик. Для смягчения: синий, чёрный (Вода) и красный (Огонь). Избегайте монохромных металлических образов."
    }
  },
  'Вода': {
    'Очень слабый (0-1)': {
      amulet: "Ваша Вода нуждается в источнике (Металл) и подкреплении (Вода). Используйте амулет из комбинации: Вода (синий/чёрный камень) + Металл (белые/металлические элементы) для источника. Можно добавить больше Воды для усиления.",
      action: "Накапливайте ресурсы. Практикуйте тишину и созерцание. Ищите «источник» — мудрых учителей, знания, внутреннюю глубину (Металл). Это год «наполнения колодца» — не тратьте, а копите.",
      colors: "Синий, чёрный + белый, металлик (Металл) для источника."
    },
    'Слабый (1-2)': {
      amulet: "Используйте амулет из Воды с элементами Металла. Например, синий камень (аквамарин, сапфир) с металлическими вставками или чёрный гематит в серебряной оправе.",
      action: "Теките медленно, но верно. Ищите источники мудрости и знаний (Металл). Практикуйте регулярное восстановление — медитацию, отдых, общение с природой.",
      colors: "Синий, чёрный + белый, металлик (Металл)."
    },
    'Сбалансированный (2-4)': {
      amulet: "Амулет из водных материалов (гематит, сапфир, аквамарин) в форме, соответствующей архетипу.",
      action: "Действуйте в соответствии с вашим архетипом. Вы можете и углубляться в знания, и течь гибко, и очищать — в зависимости от выбранного пути.",
      colors: "Синий, чёрный, тёмно-синий, индиго."
    },
    'Сильный (4-5)': {
      amulet: "Добавьте к водному амулету элементы Земли (жёлтые/коричневые камни) или Дерева (зелёные вставки). Это создаст структуру (Земля) или направление (Дерево).",
      action: "Ваша глубина и мудрость — сила. Используйте их для помощи другим, наставничества, стратегического планирования. Избегайте излишней эмоциональности и распыления — создавайте структуры (Земля) и направление (Дерево).",
      colors: "Синий, чёрный + жёлтый, коричневый (Земля) или зелёный (Дерево)."
    },
    'Очень сильный (5+)': {
      amulet: "Амулет, где Земля (структура) или Дерево (направление) преобладают над Водой. Например, жёлтый камень с синими вставками или зелёный с водными акцентами.",
      action: "Год обучения структуре и направлению. Ваша глубина может превратиться в бездну. Учитесь создавать русла (Земля) и направлять поток (Дерево). Помогайте другим навигировать, но не утопайте вместе с ними.",
      colors: "Меньше синего/чёрного, больше жёлтого/коричневого (Земля) или зелёного (Дерево)."
    }
  }
};

// --- УНИВЕРСАЛЬНЫЕ МОДИФИКАТОРЫ ПО ВЗАИМОДЕЙСТВИЯМ ---
const universalInteractionModifiers = {
  '合 (Слияние)': {
    theme: "Гармония, партнерство, объединение",
    amuletAdvice: "Амулет может быть парным или состоять из двух дополняющих элементов. Эффективен при ношении/использовании вместе с близким человеком.",
    actionAdvice: "Самые значимые достижения придут через сотрудничество. Ищите союзников, заключайте договоры, укрепляйте отношения.",
    phrase: "Энергия года способствует гармоничным союзам. Это время для построения прочных связей — как личных, так и деловых."
  },
  '冲 (Столкновение)': {
    theme: "Динамичные перемены, движение, вызовы",
    amuletAdvice: "Амулеты с защитными свойствами (обсидиан, гематит, символы щита, черепахи). Округлые формы смягчают резкость перемен.",
    actionAdvice: "Не сопротивляйтесь изменениям — управляйте ими. Планируйте «буферные зоны» в графике. Будьте готовы к неожиданным возможностям.",
    phrase: "Год приносит энергию движения. Лучшая стратегия — быть гибким и иметь запасные варианты."
  },
  '刑 (Наказание)': {
    theme: "Внутренняя работа, разрешение противоречий",
    amuletAdvice: "Успокаивающие материалы (нефрит, розовый кварц, дерево). Символы мудрости и терпения (сова, черепаха, сосна).",
    actionAdvice: "Внешние конфликты часто отражают внутренние. Практикуйте самоанализ, прощение, работу с психологом или коучем.",
    phrase: "Это время для разрешения давних внутренних противоречий. Спокойствие внутри приведет к гармонии вовне."
  },
  '害 (Вред)': {
    theme: "Скрытые сложности, необходимость бдительности",
    amuletAdvice: "Защитные камни (тигровый глаз, малахит), символы бдительности (зеркало багуа, глаз).",
    actionAdvice: "Внимание к деталям в договорах. Избегайте двусмысленных ситуаций. Доверяйте, но верифицируйте.",
    phrase: "Год учит мудрой осторожности. Иногда лучше отступить, чем ввязаться в сомнительное предприятие."
  },
  '三合 (Триада)': {
    theme: "Сильная поддержка, раскрытие потенциала",
    amuletAdvice: "Амулеты, объединяющие три элемента триады. Например, для триады Дерева: зелёный, синий, чёрный камни вместе.",
    actionAdvice: "Ваши таланты и возможности получают мощную поддержку. Действуйте смело в сферах, связанных с элементами триады.",
    phrase: "Год раскрывает ваш скрытый потенциал через поддержку сильных союзов и благоприятных обстоятельств."
  }
};

// --- МОДИФИКАТОРЫ ПО АКТИВНОМУ СТОЛПУ ---
const activePillarModifiers = {
  'год': {
    sphere: "Внешний мир, общество, имидж",
    focus: "Влияние года наиболее заметно в сфере социальных связей, репутации, взаимодействия с обществом.",
    advice: "Проявляйте себя вовне. Участвуйте в общественных проектах, работайте над личным брендом."
  },
  'месяц': {
    sphere: "Карьера, социальный статус, амбиции",
    focus: "Основные события и возможности будут связаны с профессиональной сферой, карьерным ростом, общественным положением.",
    advice: "Сосредоточьтесь на профессиональных целях. Это время для карьерных стратегий, обучения, повышения квалификации."
  },
  'день': {
    sphere: "Личность, партнерство, близкие отношения",
    focus: "Энергия года затрагивает ядро личности, самовосприятие, а также отношения с партнерами (брак, бизнес-партнеры).",
    advice: "Работайте над самооценкой, личными границами. Вкладывайтесь в качество близких отношений."
  },
  'час': {
    sphere: "Творчество, дети, внутренний мир, хобби",
    focus: "Влияние проявляется в сфере самовыражения, творчества, отношений с детьми, духовных поисков.",
    advice: "Дайте волю творчеству. Занимайтесь тем, что приносит радость без внешней оценки. Уделяйте время детям или внутреннему ребёнку."
  }
};

// --- БЛОК ГОДА (2026 - Огненная Лошадь) ---
const year2026Horse = {
  element: "Огонь",
  animal: "Лошадь",
  theme: "Стремительное движение, страсть, честолюбие, свобода",
  generalAdvice: "Год Огненной Лошади приносит энергию скорости, экспансии и ярких перемен. Это время смелых решений, путешествий и расширения горизонтов. Однако Огонь требует контроля, а Лошадь — направления. Управляйте энергией, а не подчиняйтесь ей.",
  caution: "Избегайте импульсивности. Давайте решениям «отлежаться» хотя бы сутки. Огненная Лошадь не любит ограничений — создавайте не клетки, а просторные маршруты.",
  opportunity: "Идеальное время для запуска проектов, требующих энтузиазма и скорости. Год благоприятствует тем, кто четко видит цель и готов действовать решительно."
};

// --- АМУЛЕТЫ И ПРЕДОСТЕРЕЖЕНИЯ (ОБЩИЕ ДЛЯ ОБОИХ СТИЛЕЙ) ---
const amuletAndTaboos = {
  'Дерево': {
    amulet: "Браслет из зелёной яшмы (玉) или деревянная подвеска в форме ростка",
    action: "Окружите себя живыми растениями, начните вести дневник роста и развития",
    taboos: {
      months: "Избегайте спешки и конфронтаций в месяцы Металла (申酉戌, август-октябрь)",
      health: "Следите за здоровьем печени и глаз, практикуйте регулярный отдых от экранов"
    }
  },
  'Огонь': {
    amulet: "Украшение с красным агатом или качественные солнцезащитные очки в красной оправе",
    action: "Создайте пространство для творчества, делитесь вдохновляющим опытом с близким кругом",
    taboos: {
      months: "Будьте осмотрительны в важных партнёрствах и крупных обязательствах в месяцы Воды (亥子丑, ноябрь-январь)",
      health: "Контролируйте давление и избегайте избытка острой и горячей пищи"
    }
  },
  'Земля': {
    amulet: "Керамический или фарфоровый кулон, кристалл пирита",
    action: "Систематизируйте важные области жизни, устроите капитальную организацию пространства",
    taboos: {
      months: "Остерегайтесь рискованных материальных обязательств в месяцы Дерева (寅卯辰, февраль-апрель)",
      health: "Уделяйте внимание желудку и селезёнке, соблюдайте режим питания"
    }
  },
  'Металл': {
    amulet: "Брелок в форме монеты (古钱) из металла, минималистичные стальные часы",
    action: "Проведите ревизию важных навыков, освободите пространство от лишнего (физического и ментального)",
    taboos: {
      months: "Избегайте участия в конфликтных ситуациях и острых публичных дискуссиях в месяцы Огня (巳午未, май-июль)",
      health: "Берегите лёгкие и кожу, практикуйте дыхательные упражнения"
    }
  },
  'Вода': {
    amulet: "Чёрный/синий браслет из гематита, символ потока и мудрости",
    action: "Начните вести дневник инсайтов и наблюдений, практикуйте медитацию и внутреннюю тишину",
    taboos: {
      months: "Осторожность в поездках и перемещениях в месяцы Земли (辰戌丑未, апрель, июль, октябрь, январь)",
      health: "Контролируйте эмоциональные перепады и берегите почки, поддерживайте водный баланс"
    }
  }
};

// --- ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ДЛЯ РАБОТЫ С РАСШИРЕННОЙ БИБЛИОТЕКОЙ ---

// Определение категории силы элемента
function categorizeStrength(strength) {
  if (strength <= 1) return 'Очень слабый (0-1)';
  if (strength <= 2) return 'Слабый (1-2)';
  if (strength < 4) return 'Сбалансированный (2-4)';
  if (strength <= 5) return 'Сильный (4-5)';
  return 'Очень сильный (5+)';
}

// Выбор базового архетипа (случайный или детерминированный)
function selectBaseTemplate(element) {
  const templates = elementBaseTemplates[element] || elementBaseTemplates['Дерево'];
  // Можно сделать детерминированный выбор на основе дополнительных факторов
  // Пока используем случайный для разнообразия
  const randomIndex = Math.floor(Math.random() * templates.length);
  return templates[randomIndex];
}

// Получение модификатора силы для элемента
function getStrengthModifier(element, strengthCategory) {
  const modifiers = elementStrengthModifiers[element] || elementStrengthModifiers['Дерево'];
  return modifiers[strengthCategory] || modifiers['Сбалансированный (2-4)'];
}

// Генерация полных рекомендаций по цветам для ВСЕХ пользователей
function generateFullColorRecommendations(dayMasterElement, strengthCategory, usefulElements) {
  const elementColorMap = {
    'Дерево': {
      main: 'зелёный, изумрудный, салатовый, оливковый',
      support: 'синий, чёрный, тёмно-синий (Вода питает Дерево)',
      balance: 'белый, серебряный, золотой, серый (Металл контролирует Дерево)'
    },
    'Огонь': {
      main: 'красный, оранжевый, розовый, коралловый, алый',
      support: 'зелёный, изумрудный (Дерево питает Огонь)',
      balance: 'синий, чёрный, тёмно-синий (Вода контролирует Огонь)'
    },
    'Земля': {
      main: 'жёлтый, коричневый, бежевый, терракотовый, охра',
      support: 'красный, оранжевый (Огонь питает Землю)',
      balance: 'зелёный, изумрудный (Дерево контролирует Землю)'
    },
    'Металл': {
      main: 'белый, серебряный, золотой, серый, платиновый',
      support: 'жёлтый, коричневый, бежевый (Земля питает Металл)',
      balance: 'красный, оранжевый (Огонь контролирует Металл)'
    },
    'Вода': {
      main: 'синий, чёрный, тёмно-синий, индиго, фиолетовый',
      support: 'белый, серебряный, золотой (Металл питает Воду)',
      balance: 'жёлтый, коричневый, бежевый (Земля контролирует Воду)'
    }
  };
  
  const colors = elementColorMap[dayMasterElement] || elementColorMap['Дерево'];
  const isWeak = strengthCategory.includes('слабый') || strengthCategory.includes('Очень слабый');
  const isStrong = strengthCategory.includes('сильный') || strengthCategory.includes('Очень сильный');
  
  let result = `Основные цвета: ${colors.main}.`;
  
  if (isWeak) {
    result += ` Для поддержки используйте: ${colors.support}.`;
  } else if (isStrong) {
    result += ` Для баланса используйте: ${colors.balance}.`;
  } else {
    result += ` Для гармонизации можно добавлять акценты: ${colors.support} или ${colors.balance}.`;
  }
  
  // Добавляем цвета из полезных элементов, если они есть
  if (usefulElements && usefulElements.length > 0) {
    const usefulColorMap = {
      'Дерево': 'зелёный, изумрудный',
      'Огонь': 'красный, оранжевый',
      'Земля': 'жёлтый, коричневый',
      'Металл': 'белый, серебряный, золотой',
      'Вода': 'синий, чёрный'
    };
    
    const additionalColors = usefulElements
      .filter(el => el !== dayMasterElement)
      .map(el => usefulColorMap[el] || el)
      .filter((v, i, a) => a.indexOf(v) === i) // Убираем дубликаты
      .join(', ');
    
    if (additionalColors) {
      result += ` Благоприятные дополнительные цвета: ${additionalColors}.`;
    }
  }
  
  return result;
}

// Интеграция полезных элементов в цвета
function integrateUsefulElements(usefulElements, strengthCategory) {
  if (!usefulElements || usefulElements.length === 0) return '';
  
  const colorMap = {
    'Дерево': 'зелёный',
    'Огонь': 'красный',
    'Земля': 'жёлтый/коричневый',
    'Металл': 'белый/золотой',
    'Вода': 'синий/чёрный'
  };
  
  const isWeak = strengthCategory.includes('слабый') || strengthCategory.includes('Очень слабый');
  
  // Если есть дополнительные благоприятные элементы
  if (usefulElements.length > 1) {
    const additionalColors = usefulElements.slice(1).map(el => colorMap[el] || el).join(', ');
    const prefix = isWeak ? 'Для дополнительной поддержки также используйте цвета: ' : 'Для гармоничного баланса также используйте цвета: ';
    return ` ${prefix}${additionalColors}.`;
  }
  
  return '';
}

// Добавление советов по комбинации элементов в амулет (улучшенная версия)
function addElementCombinationAdvice(usefulElements, strengthCategory, dayMasterElement) {
  if (!usefulElements || usefulElements.length === 0) return '';
  
  const isWeak = strengthCategory.includes('слабый') || strengthCategory.includes('Очень слабый');
  
  // Находим элемент, отличный от основного, для комбинации
  const secondElement = usefulElements.find(el => el !== dayMasterElement);
  
  if (secondElement) {
    const elementNames = {
      'Дерево': 'элементами Дерева (зелёные камни, деревянные вставки)',
      'Огонь': 'элементами Огня (красные камни, огненные символы)',
      'Земля': 'элементами Земли (жёлтые камни, керамика)',
      'Металл': 'элементами Металла (белые камни, металлические детали)',
      'Вода': 'элементами Воды (синие камни, водные символы)'
    };
    
    const purpose = isWeak ? 'дополнительной поддержки' : 'гармоничного баланса';
    return ` Дополнительно можно комбинировать с ${elementNames[secondElement] || `элементами ${secondElement}`} для ${purpose}.`;
  }
  
  return '';
}

// Генерация заметки о дисбалансе (улучшенная версия)
function generateBalanceNote(imbalance, dayMasterElement) {
  if (!imbalance || (!imbalance.excess?.length && !imbalance.deficient?.length)) return '';
  
  // Маппинг элементов на цвета
  const elementColors = {
    'Дерево': 'зелёный, изумрудный, салатовый',
    'Огонь': 'красный, оранжевый, розовый, коралловый',
    'Земля': 'жёлтый, коричневый, бежевый, терракотовый, охра',
    'Металл': 'белый, серебряный, золотой, серый, платиновый',
    'Вода': 'синий, чёрный, тёмно-синий, индиго, фиолетовый'
  };
  
  // Маппинг элементов на элементы, которые их ослабляют (контролируют)
  const weakeningElements = {
    'Дерево': ['Металл'], // Металл рубит Дерево
    'Огонь': ['Вода'],    // Вода тушит Огонь
    'Земля': ['Дерево'],  // Дерево истощает Землю
    'Металл': ['Огонь'],  // Огонь плавит Металл
    'Вода': ['Земля']     // Земля впитывает Воду
  };
  
  // Маппинг элементов на элементы, которые их питают (производят)
  const nourishingElements = {
    'Дерево': ['Вода'],    // Вода питает Дерево
    'Огонь': ['Дерево'],   // Дерево питает Огонь
    'Земля': ['Огонь'],    // Огонь питает Землю
    'Металл': ['Земля'],   // Земля питает Металл
    'Вода': ['Металл']     // Металл питает Воду
  };
  
  const parts = [];
  const recommendedColors = [];
  
  // Обрабатываем избыток
  if (imbalance.excess && imbalance.excess.length > 0) {
    const excessElements = imbalance.excess.filter(el => el !== dayMasterElement);
    if (excessElements.length > 0) {
      const excessList = excessElements.join(', ');
      parts.push(`В вашей карте заметен избыток элементов ${excessList}.`);
      
      // Определяем цвета для ослабления избытка
      excessElements.forEach(element => {
        const weakening = weakeningElements[element];
        if (weakening && weakening.length > 0) {
          weakening.forEach(weakEl => {
            if (elementColors[weakEl]) {
              recommendedColors.push(...elementColors[weakEl].split(', '));
            }
          });
        }
      });
    }
  }
  
  // Обрабатываем недостаток
  if (imbalance.deficient && imbalance.deficient.length > 0) {
    const deficientElements = imbalance.deficient;
    parts.push(`В то же время наблюдается недостаток элементов ${deficientElements.join(', ')}.`);
    
    // Определяем цвета для усиления недостатка
    deficientElements.forEach(element => {
      if (elementColors[element]) {
        recommendedColors.push(...elementColors[element].split(', '));
      }
      // Также добавляем цвета питающих элементов
      const nourishing = nourishingElements[element];
      if (nourishing && nourishing.length > 0) {
        nourishing.forEach(nourEl => {
          if (elementColors[nourEl]) {
            recommendedColors.push(...elementColors[nourEl].split(', '));
          }
        });
      }
    });
  }
  
  // Формируем итоговый текст
  let result = '';
  if (parts.length > 0) {
    result = parts.join(' ');
    
    // Добавляем рекомендации по цветам
    if (recommendedColors.length > 0) {
      // Убираем дубликаты
      const uniqueColors = [...new Set(recommendedColors)];
      result += `\n\n🎨 Рекомендуемые цвета для гармонизации: ${uniqueColors.join(', ')}. Используйте эти цвета в одежде, аксессуарах, интерьере и материалах амулета для балансировки энергии.`;
    }
  }
  
  return result;
}

// Получение контекста года для элемента
function getElementYearContext(element, strengthCategory) {
  const contexts = {
    'Дерево': {
      'Очень слабый (0-1)': 'Вам нужно быть особенно осторожным с ярким Огнём года — он может иссушить ваш росток. Ищите Воду (поддержку, знания) и оставайтесь гибким, чтобы гнуться под порывами ветра перемен, не ломаясь.',
      'Слабый (1-2)': 'Огненная Лошадь может дать вам энергию для роста, но важно не перегореть. Ищите баланс между движением и восстановлением.',
      'Сбалансированный (2-4)': 'Год даёт вам возможность расти и развиваться. Используйте энергию Лошади для смелых начинаний, но сохраняйте корни.',
      'Сильный (4-5)': 'Ваша сила может направлять энергию Огненной Лошади. Используйте это для масштабных проектов, но избегайте излишней прямолинейности.',
      'Очень сильный (5+)': 'Избыток силы требует контроля. Огненная Лошадь может усилить вашу мощь — направляйте её в созидание, а не разрушение.'
    },
    'Огонь': {
      'Очень слабый (0-1)': 'Год Огненной Лошади может дать вам поддержку, но важно не дать яркому пламени года затмить вашу искру. Ищите топливо (Дерево) и защиту (Земля).',
      'Слабый (1-2)': 'Энергия года может подпитать ваше пламя. Используйте это для роста, но не позволяйте внешнему Огню контролировать вас.',
      'Сбалансированный (2-4)': 'Год резонирует с вашей природой. Используйте энергию Лошади для ярких свершений, но контролируйте интенсивность.',
      'Сильный (4-5)': 'Ваш Огонь и Огонь года могут создать мощную энергию. Направляйте её в созидание, избегая перегрева и импульсивности.',
      'Очень сильный (5+)': 'Избыток Огня требует активного охлаждения. Год может усилить вашу энергию — используйте Воду и Металл для баланса.'
    },
    'Земля': {
      'Очень слабый (0-1)': 'Огненная Лошадь может дать вам энергию для укрепления, но важно не дать её импульсивности разрушить вашу стабильность. Ищите структуру (Металл) и поддержку (Огонь).',
      'Слабый (1-2)': 'Год может помочь вам создать прочный фундамент. Используйте энергию Лошади для движения, но сохраняйте устойчивость.',
      'Сбалансированный (2-4)': 'Ваша стабильность может направлять энергию года. Используйте это для создания долгосрочных структур.',
      'Сильный (4-5)': 'Ваша непоколебимость — сила. Огненная Лошадь может дать вам импульс для движения — используйте это, но избегайте застоя.',
      'Очень сильный (5+)': 'Избыток стабильности может превратиться в окаменелость. Год учит гибкости — используйте энергию Лошади для движения и адаптации.'
    },
    'Металл': {
      'Очень слабый (0-1)': 'Огненная Лошадь может раскалить ваш слабый Металл до опасности. Ищите поддержку (Земля) и защиту от перегрева.',
      'Слабый (1-2)': 'Год может дать вам энергию для укрепления, но важно не дать Огню года ослабить ваш Металл. Ищите баланс через Землю.',
      'Сбалансированный (2-4)': 'Ваш Металл может направлять энергию Огненной Лошади. Используйте это для ясных решений и структурированных действий.',
      'Сильный (4-5)': 'Огонь года может закалить ваш Металл, превратив его в инструмент. Используйте это для масштабных проектов, но избегайте резкости.',
      'Очень сильный (5+)': 'Избыток Металла требует смягчения. Огненная Лошадь может усилить вашу жёсткость — используйте Воду и Огонь для гибкости.'
    },
    'Вода': {
      'Очень слабый (0-1)': 'Огненная Лошадь может иссушить ваш слабый источник. Ищите поддержку (Металл) и защиту от перегрева. Практикуйте тишину и накопление.',
      'Слабый (1-2)': 'Год может дать вам движение, но важно не дать Огню испарить вашу Воду. Ищите источники (Металл) и сохраняйте глубину.',
      'Сбалансированный (2-4)': 'Ваша гибкость может направлять энергию года. Используйте это для адаптации и коммуникации, сохраняя глубину.',
      'Сильный (4-5)': 'Ваша глубина — сила. Огненная Лошадь может дать вам импульс для движения — используйте это, но создавайте структуры (Земля) для направления потока.',
      'Очень сильный (5+)': 'Избыток Воды может превратиться в потоп. Год учит структуре — используйте энергию Лошади для создания русла и направления потока.'
    }
  };
  
  return contexts[element]?.[strengthCategory] || `Год Огненной Лошади приносит энергию движения и перемен. Используйте это для развития вашего ${element}.`;
}

// --- НОВАЯ ФУНКЦИЯ ГЕНЕРАЦИИ РАСШИРЕННЫХ РЕКОМЕНДАЦИЙ ---
export function generateAdvancedRecommendations(dayMasterElement, strength, usefulElements, interactions, imbalance, activePillar) {
  // 1. Определяем категорию силы
  const strengthCategory = categorizeStrength(strength);
  
  // 2. Выбираем базовый архетип
  const baseTemplate = selectBaseTemplate(dayMasterElement);
  
  // 3. Получаем модификаторы по силе
  const strengthMod = getStrengthModifier(dayMasterElement, strengthCategory);
  
  // 4. Начинаем собирать рекомендацию
  let recommendation = {
    amulet: '',
    action: '',
    colors: '',
    health: '',
    specialNote: '',
    balanceNote: '',
    yearContext: ''
  };
  
  // 5. Объединяем базовый шаблон с модификатором силы (с плавным соединением)
  // Функция для плавного соединения предложений
  const smoothJoin = (base, addition) => {
    const baseClean = base.trim().replace(/\.+$/, ''); // Убираем точки в конце
    const additionClean = addition.trim();
    return `${baseClean}. ${additionClean}`;
  };
  
  // Для амулета: базовый + модификатор силы
  recommendation.amulet = smoothJoin(baseTemplate.amulet, strengthMod.amulet);
  
  // Для действия: базовый + модификатор силы
  recommendation.action = smoothJoin(baseTemplate.action, strengthMod.action);
  
  // 6. Генерируем базовые цвета из модификатора силы
  recommendation.colors = strengthMod.colors;
  recommendation.health = `${baseTemplate.healthFocus} ${baseTemplate.healthAdvice}`;
  
  // 7. Интегрируем полезные элементы (добавляем к цветам)
  recommendation.colors += integrateUsefulElements(usefulElements, strengthCategory);
  recommendation.amulet += addElementCombinationAdvice(usefulElements, strengthCategory, dayMasterElement);
  
  // 8. ОБЯЗАТЕЛЬНО: Генерируем полные рекомендации по цветам для ВСЕХ пользователей
  // Если цвета не были сгенерированы или слишком короткие, добавляем полный список
  if (!recommendation.colors || recommendation.colors.length < 20) {
    recommendation.colors = generateFullColorRecommendations(dayMasterElement, strengthCategory, usefulElements);
  }
  
  // 7. Добавляем советы по взаимодействиям (с плавным соединением)
  if (interactions && interactions.length > 0) {
    const smoothAdd = (base, addition) => {
      const baseClean = base.trim().replace(/\.+$/, '');
      const additionClean = addition.trim();
      return `${baseClean}. ${additionClean}`;
    };
    
    interactions.forEach(interaction => {
      const mod = universalInteractionModifiers[interaction.type];
      if (mod) {
        // Плавное добавление к амулету
        if (mod.amuletAdvice) {
          recommendation.amulet = smoothAdd(recommendation.amulet, mod.amuletAdvice);
        }
        // Плавное добавление к действию
        if (mod.actionAdvice) {
          recommendation.action = smoothAdd(recommendation.action, mod.actionAdvice);
        }
        // Добавляем фразу в особое примечание
        if (mod.phrase) {
          recommendation.specialNote += (recommendation.specialNote ? ' ' : '') + mod.phrase;
        }
      }
    });
  }
  
  // 8. Учитываем дисбаланс
  if (imbalance) {
    recommendation.balanceNote = generateBalanceNote(imbalance, dayMasterElement);
  }
  
  // 9. Фокусируем на активном столпе (с плавным соединением)
  if (activePillar) {
    const pillarMod = activePillarModifiers[activePillar];
    if (pillarMod) {
      recommendation.action += ` Особое внимание в этом году уделите сфере ${pillarMod.sphere.toLowerCase()}. ${pillarMod.advice}`;
    }
  }
  
  // 10. Добавляем контекст года
  recommendation.yearContext = `${year2026Horse.generalAdvice} Для вашего элемента (${dayMasterElement}) это означает: ${getElementYearContext(dayMasterElement, strengthCategory)}`;
  
  return recommendation;
}

// --- ГЕНЕРАЦИЯ ПЕРСОНАЛЬНОГО АМУЛЕТА (СТАРАЯ ФУНКЦИЯ - ОСТАВЛЯЕМ ДЛЯ ОБРАТНОЙ СОВМЕСТИМОСТИ) ---
function generatePersonalizedAmulet(dayMasterElement, strength, usefulElements, interactions) {
  // Используем новую функцию, если доступны все данные
  const strengthCategory = categorizeStrength(strength);
  const baseTemplate = selectBaseTemplate(dayMasterElement);
  const strengthMod = getStrengthModifier(dayMasterElement, strengthCategory);
  
  let personalizedAmulet = `${baseTemplate.amulet} ${strengthMod.amulet}`;
  
  // Добавляем советы по взаимодействиям
  if (interactions && interactions.length > 0) {
    interactions.forEach(interaction => {
      const mod = universalInteractionModifiers[interaction.type];
      if (mod) {
        personalizedAmulet += ` ${mod.amuletAdvice}`;
      }
    });
  }
  
  return personalizedAmulet;
}

// --- ГЕНЕРАЦИЯ ПЕРСОНАЛЬНОГО ДЕЙСТВИЯ (ОБНОВЛЕНО С РАСШИРЕННОЙ БИБЛИОТЕКОЙ) ---
function generatePersonalizedAction(dayMasterElement, strength, usefulElements) {
  const strengthCategory = categorizeStrength(strength);
  const baseTemplate = selectBaseTemplate(dayMasterElement);
  const strengthMod = getStrengthModifier(dayMasterElement, strengthCategory);
  
  // Объединяем базовое действие с модификатором силы
  let personalizedAction = `${baseTemplate.action} ${strengthMod.action}`;
  
  return personalizedAction;
}

// --- ГЕНЕРАЦИЯ ПЕРСОНАЛЬНЫХ ПРЕДОСТЕРЕЖЕНИЙ ---
function generatePersonalizedTaboos(dayMasterElement, strength, baziAnalysis) {
  const baseTaboos = amuletAndTaboos[dayMasterElement]?.taboos || amuletAndTaboos['Дерево'].taboos;
  
  // Получаем опасные месяцы на основе контролирующего элемента
  const dangerousMonthsData = getDangerousMonths(dayMasterElement);
  const dangerousElement = dangerousMonthsData.element;
  const dangerousMonths = dangerousMonthsData.months;
  const dangerousBranches = dangerousMonthsData.branches.join('');
  
  // Формируем персональное предостережение
  const monthsWarning = `Избегайте участия в конфликтных ситуациях и острых публичных дискуссиях в месяцы ${dangerousElement} (${dangerousBranches}, ${dangerousMonths})`;
  
  return {
    months: monthsWarning,
    health: baseTaboos.health
  };
}

// --- ГЕНЕРАЦИЯ ПЕРСОНАЛЬНЫХ СОВЕТОВ ДЛЯ СОЗДАНИЯ АМУЛЕТА ---
function generatePersonalizedAmuletCreation(dayMasterElement, usefulElements) {
  const baseAdvice = amuletCreationAdvice[dayMasterElement] || amuletCreationAdvice['Дерево'];
  
  // Добавляем благоприятные элементы и их цвета
  const favorableElements = usefulElements.filter(el => el !== dayMasterElement);
  const favorableColorsList = favorableElements.map(el => {
    const colorMap = {
      'Дерево': 'зелёный',
      'Огонь': 'красный',
      'Земля': 'жёлтый/коричневый',
      'Металл': 'белый/золотой',
      'Вода': 'синий/чёрный'
    };
    return colorMap[el] || el;
  });
  
  return {
    element: baseAdvice.element,
    symbol: baseAdvice.symbol,
    colors: baseAdvice.colors + (favorableColorsList.length > 0 ? `, ${favorableColorsList.join(', ')}` : ''),
    materials: baseAdvice.materials,
    favorableElements: favorableElements.length > 0 ? favorableElements : [usefulElements[0] || 'Дерево'],
    favorableColors: favorableColorsList.length > 0 ? favorableColorsList : ['зелёный', 'красный']
  };
}

// --- ПРИМЕНЕНИЕ МОДИФИКАТОРОВ ОТ ВЗАИМОДЕЙСТВИЙ ---
function applyInteractionModifiers(interactions, stemInteractions = [], specialCombinations = []) {
  const modifiers = {
    forecastAddition: '',
    notes: []
  };
  
  const hasMerger = interactions.some(i => i.type === '合' && i.impact === 'positive');
  if (hasMerger) {
    modifiers.forecastAddition += 'В этом году вы можете рассчитывать на неожиданную поддержку и гармоничные союзы, которые могут прийти словно сами собой.';
    modifiers.notes.push('Наличие слияний в вашей карте указывает на благоприятные союзы и взаимную поддержку.');
  }
  
  const hasClash = interactions.some(i => i.type === '冲');
  if (hasClash) {
    modifiers.forecastAddition += ' Год может принести важные перемены; сохраняйте внутреннее равновесие, чтобы суметь использовать их себе во благо.';
    modifiers.notes.push('Столкновения в карте указывают на период перемен, требующий гибкости и адаптивности.');
  }
  
  const hasPunishment = interactions.some(i => i.type === '刑' && i.impact === 'negative');
  if (hasPunishment) {
    modifiers.forecastAddition += ' Проявите терпение в сложных ситуациях; иногда мудрость — это дать времени всё расставить по местам.';
    modifiers.notes.push('Наличие наказаний требует особой внимательности к скрытым препятствиям.');
  }
  
  // НОВОЕ: Проверяем взаимодействия стволов (合化) - трансформация элементов
  if (stemInteractions && stemInteractions.length > 0) {
    const transformElements = stemInteractions.map(si => si.transformsTo);
    const uniqueElements = [...new Set(transformElements)];
    modifiers.forecastAddition += ` Ваша карта содержит взаимодействия стволов, которые могут трансформировать энергию в элементы ${uniqueElements.join(' и ')}. Это может усилить соответствующие качества в вашей жизни.`;
    modifiers.notes.push(`Взаимодействия стволов (合化) указывают на возможность трансформации энергии в элементы: ${uniqueElements.join(', ')}.`);
  }
  
  // НОВОЕ: Проверяем специальные комбинации (三合, 三会) - мощные триады
  const completeTriads = specialCombinations.filter(sc => sc.completeness === 'complete');
  if (completeTriads.length > 0) {
    const triadElements = completeTriads.map(t => t.element);
    modifiers.forecastAddition += ` В вашей карте присутствуют полные триады (${completeTriads.map(t => t.type).join(', ')}), что может создать мощную концентрацию энергии элементов ${[...new Set(triadElements)].join(' и ')}.`;
    modifiers.notes.push(`Полные триады (${completeTriads.map(t => t.name).join(', ')}) указывают на особую силу и концентрацию энергии.`);
  } else {
    const partialTriads = specialCombinations.filter(sc => sc.completeness === 'partial');
    if (partialTriads.length > 0) {
      modifiers.notes.push(`Частичные триады (${partialTriads.map(t => t.name).join(', ')}) указывают на потенциал для развития соответствующих качеств.`);
    }
  }
  
  return modifiers;
}

// --- ГЕНЕРАЦИЯ СОВЕТОВ ПО ВЗАИМОДЕЙСТВИЯМ ---
function generateInteractionAdvice(interactions) {
  const advice = {
    positive: [],
    neutral: [],
    warnings: []
  };
  
  interactions.forEach(interaction => {
    const pillarNames = {
      '年柱': 'семейных отношениях и корнях',
      '月柱': 'карьере и социальном статусе',
      '日柱': 'личной жизни и здоровье',
      '时柱': 'творчестве и потомках'
    };
    
    const pillarDesc = interaction.pillars.map(p => pillarNames[p] || p).join(' и ');
    
    if (interaction.impact === 'positive') {
      advice.positive.push({
        type: interaction.type,
        description: `${interaction.description} Особенно влияет на ${pillarDesc}.`
      });
    } else if (interaction.impact === 'neutral') {
      advice.neutral.push({
        type: interaction.type,
        description: `${interaction.description} Влияет на ${pillarDesc}.`
      });
    } else {
      advice.warnings.push({
        type: interaction.type,
        description: `${interaction.description} Будьте осторожны в ${pillarDesc}.`
      });
    }
  });
  
  return advice;
}

// --- ГЕНЕРАЦИЯ СОВЕТОВ ПО СИЛЕ СТВОЛОВ ---
function generateStemAdvice(stemStrengths) {
  const advice = [];
  const pillarNames = {
    year: 'Год',
    month: 'Месяц',
    day: 'День',
    hour: 'Час'
  };
  
  Object.entries(stemStrengths).forEach(([pillar, strength]) => {
    if (strength.strength <= 2) {
      advice.push({
        pillar: pillarNames[pillar],
        element: strength.element,
        glyph: strength.glyph,
        advice: `Ствол ${pillarNames[pillar]} (${strength.glyph}, ${strength.element}) слабый. Усильте его влияние через соответствующие элементы в окружении.`
      });
    } else if (strength.strength >= 4) {
      advice.push({
        pillar: pillarNames[pillar],
        element: strength.element,
        glyph: strength.glyph,
        advice: `Ствол ${pillarNames[pillar]} (${strength.glyph}, ${strength.element}) сильный. Используйте его энергию для достижения целей в соответствующей сфере.`
      });
    }
  });
  
  return advice;
}

// --- ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ДЛЯ ИНТЕГРАЦИИ ---

// Расчёт дисбаланса элементов в карте
function calculateImbalance(baziAnalysis) {
  if (!baziAnalysis.elementBalance) {
    return { excess: [], deficient: [] };
  }
  
  const balance = baziAnalysis.elementBalance;
  const allElements = ['Дерево', 'Огонь', 'Земля', 'Металл', 'Вода'];
  
  // Вычисляем среднее значение для определения нормы
  const values = allElements.map(el => balance[el] || 0);
  const average = values.reduce((a, b) => a + b, 0) / values.length;
  const threshold = average * 0.3; // 30% от среднего - порог для определения избытка/недостатка
  
  const excess = [];
  const deficient = [];
  
  allElements.forEach(element => {
    const value = balance[element] || 0;
    if (value > average + threshold) {
      excess.push(element);
    } else if (value < average - threshold) {
      deficient.push(element);
    }
  });
  
  return { excess, deficient };
}

// Определение активного столпа на основе взаимодействий
function determineActivePillar(baziAnalysis) {
  if (!baziAnalysis.interactions || baziAnalysis.interactions.length === 0) {
    // По умолчанию - месяц (карьера)
    return 'месяц';
  }
  
  // Подсчитываем взаимодействия по столпам
  const pillarCounts = {
    'год': 0,
    'месяц': 0,
    'день': 0,
    'час': 0
  };
  
  baziAnalysis.interactions.forEach(interaction => {
    if (interaction.pillar) {
      const pillar = interaction.pillar.toLowerCase();
      if (pillarCounts.hasOwnProperty(pillar)) {
        pillarCounts[pillar]++;
      }
    }
    // Также проверяем pillars массив, если есть
    if (interaction.pillars && Array.isArray(interaction.pillars)) {
      interaction.pillars.forEach(p => {
        const pillar = p.toLowerCase();
        if (pillarCounts.hasOwnProperty(pillar)) {
          pillarCounts[pillar]++;
        }
      });
    }
  });
  
  // Находим столп с максимальным количеством взаимодействий
  let maxCount = 0;
  let activePillar = 'месяц'; // По умолчанию
  
  Object.entries(pillarCounts).forEach(([pillar, count]) => {
    if (count > maxCount) {
      maxCount = count;
      activePillar = pillar;
    }
  });
  
  return activePillar;
}

// --- ГЛАВНАЯ ФУНКЦИЯ ГЕНЕРАЦИИ КОНТЕНТА ---
export function generateContent(baziAnalysis, currentYear = 2026, yearAnimal = 'Огненная Лошадь', style = 'poetic') {
  const dayMasterElement = baziAnalysis.dayMaster.element;
  const strength = baziAnalysis.dayMaster.strength;
  
  // Выбираем матрицу в зависимости от стиля
  const contentMatrix = style === 'poetic' ? poeticContentMatrix : practicalContentMatrix;
  const template = contentMatrix[dayMasterElement] || contentMatrix['Дерево'];
  
  // Определяем силу для выбора контента
  let strengthKey = 'medium';
  if (strength >= 4) strengthKey = 'strong';
  else if (strength <= 2) strengthKey = 'weak';
  
  // Получаем базовый контент
  const baseContent = template[strengthKey];
  
  // Применяем модификаторы от взаимодействий
  const interactionModifiers = applyInteractionModifiers(
    baziAnalysis.interactions || [],
    baziAnalysis.stemInteractions || [],
    baziAnalysis.specialCombinations || []
  );
  let forecast = baseContent.forecast;
  if (interactionModifiers.forecastAddition) {
    forecast += ' ' + interactionModifiers.forecastAddition;
  }
  
  // Генерируем дополнительные советы
  const interactionAdvice = generateInteractionAdvice(baziAnalysis.interactions || []);
  const stemAdvice = generateStemAdvice(baziAnalysis.stemStrengths || {});
  
  // ИСПОЛЬЗУЕМ НОВУЮ РАСШИРЕННУЮ БИБЛИОТЕКУ
  // Рассчитываем дисбаланс и активный столп
  const imbalance = calculateImbalance(baziAnalysis);
  const activePillar = determineActivePillar(baziAnalysis);
  
  // Генерируем расширенные рекомендации через новую библиотеку
  const advancedRecommendations = generateAdvancedRecommendations(
    dayMasterElement,
    strength,
    baziAnalysis.usefulElements || [],
    baziAnalysis.interactions || [],
    imbalance,
    activePillar
  );
  
  // Используем расширенные рекомендации
  const personalizedAmulet = advancedRecommendations.amulet;
  const personalizedAction = advancedRecommendations.action;
  const personalizedTaboos = generatePersonalizedTaboos(dayMasterElement, strength, baziAnalysis);
  
  // Получаем советы для создания амулета (базовые, но с учётом благоприятных элементов)
  const amuletAdvice = generatePersonalizedAmuletCreation(dayMasterElement, baziAnalysis.usefulElements);
  
  // Получаем благоприятные элементы и их цвета (из расширенных рекомендаций)
  const colorsFromRecommendations = advancedRecommendations.colors || '';
  
  // Формируем результат с интеграцией расширенной библиотеки
  return {
    style: style, // Сохраняем выбранный стиль
    forecast: {
      main: forecast,
      year: `${currentYear} год (${yearAnimal})`,
      element: dayMasterElement,
      strength: strength
    },
    energy: {
      description: baseContent.energy
    },
    advice: {
      direction: baseContent.advice
    },
    ritual: {
      description: baseContent.ritual
    },
    transformation: {
      description: baseContent.transformation || ''
    },
    amulet: {
      item: personalizedAmulet,
      action: personalizedAction,
      colors: advancedRecommendations.colors || ''
    },
    taboos: {
      months: personalizedTaboos.months,
      health: personalizedTaboos.health,
      additional: interactionAdvice.warnings
    },
    amuletCreation: {
      element: amuletAdvice.element,
      symbol: amuletAdvice.symbol,
      colors: amuletAdvice.colors,
      materials: amuletAdvice.materials,
      favorableElements: baziAnalysis.usefulElements,
      favorableColors: advancedRecommendations.colors ? advancedRecommendations.colors.split('.').filter(c => c.trim()) : []
    },
    // Новые поля из расширенной библиотеки
    balanceNote: advancedRecommendations.balanceNote || '',
    yearContext: advancedRecommendations.yearContext || '',
    specialNote: advancedRecommendations.specialNote || '',
    health: advancedRecommendations.health || '',
    additional: {
      interactions: interactionAdvice,
      stemStrengths: stemAdvice,
      usefulElements: baziAnalysis.usefulElements,
      interactionNotes: interactionModifiers.notes,
      imbalance: imbalance,
      activePillar: activePillar
    }
  };
}

// --- ФОРМАТИРОВАНИЕ ДЛЯ ВЫВОДА ---
export function formatContentForDisplay(content) {
  return {
    style: content.style,
    mainForecast: `${content.forecast.year}: ${content.forecast.main}`,
    energy: content.energy.description,
    advice: content.advice.direction,
    ritual: content.ritual.description,
    transformation: content.transformation?.description || '',
    recommendations: {
      amulet: `Амулет: ${content.amulet.item}`,
      action: `Действие: ${content.amulet.action}`,
      colors: content.amulet.colors || `Благоприятные цвета: ${content.amuletCreation.favorableColors?.join(', ') || ''}`
    },
    warnings: {
      months: content.taboos.months,
      health: content.taboos.health,
      additional: content.taboos.additional
    },
    amuletCreation: {
      title: 'Советы для создания амулета по выводам Бацзы:',
      element: `Элемент: ${content.amuletCreation.element}`,
      symbol: `Символ: ${content.amuletCreation.symbol}`,
      colors: `Цвета: ${content.amuletCreation.colors}`,
      materials: `Материалы: ${content.amuletCreation.materials}`,
      favorableElements: `Благоприятные элементы: ${content.amuletCreation.favorableElements.join(', ')}`,
      favorableColors: `Благоприятные цвета: ${content.amuletCreation.favorableColors.join(', ')}`
    },
    interactions: {
      positive: content.additional.interactions.positive,
      neutral: content.additional.interactions.neutral,
      warnings: content.additional.interactions.warnings
    },
    stemAdvice: content.additional.stemStrengths,
    interactionNotes: content.additional.interactionNotes,
    // Новые поля из расширенной библиотеки
    balanceNote: content.balanceNote || '',
    yearContext: content.yearContext || '',
    specialNote: content.specialNote || '',
    health: content.health || ''
  };
}
